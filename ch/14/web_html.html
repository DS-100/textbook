
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>14.5. XML, HTML, and XPath &#8212; Learning Data Science</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/custom.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="14.6. Summary" href="web_summary.html" />
    <link rel="prev" title="14.4. REST" href="web_rest.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-113006011-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Learning Data Science</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Frontmatter
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../preface.html">
   Preface
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  The Data Science Lifecycle
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01/lifecycle_intro.html">
   1. The Data Science Lifecycle
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/lifecycle_cycle.html">
     1.1. The Stages of the Lifecycle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/lifecycle_map.html">
     1.2. Examples of the Lifecycle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/lifecycle_summary.html">
     1.3. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02/data_scope_intro.html">
   2. Questions and Data Scope
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data_scope_big_data_hubris.html">
     2.1. Big Data and New Opportunities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data_scope_construct.html">
     2.2. Target Population, Access Frame, Sample
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data_scope_protocols.html">
     2.3. Instruments and Protocols
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data_scope_natural.html">
     2.4. Measuring Natural Phenomenon
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data_scope_accuracy.html">
     2.5. Accuracy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data_scope_summary.html">
     2.6. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03/theory_intro.html">
   3. Simulation and Data Design
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/theory_urn.html">
     3.1. The Urn Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/theory_election.html">
     3.2. Example: Simulating Election Poll Bias and Variance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/theory_vaccine_efficacy.html">
     3.3. Example: Simulating a Randomized Trial for a Vaccine
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/theory_measurement_error.html">
     3.4. Example: Measuring Air Quality
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/theory_summary.html">
     3.5. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04/modeling_intro.html">
   4. Modeling with Summary Statistics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/modeling_simple.html">
     4.1. The Constant Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/modeling_loss_functions.html">
     4.2. Minimizing Loss
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/modeling_summary.html">
     4.3. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../05/bus_intro.html">
   5. Case Study: Why is my Bus Always Late?
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/bus_scope.html">
     5.1. Question and Scope
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/bus_clean.html">
     5.2. Data Wrangling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/bus_eda.html">
     5.3. Exploring Bus Times
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/bus_modeling.html">
     5.4. Modeling Wait Times
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/bus_summary.html">
     5.5. Summary
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Rectangular Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../06/pandas_intro.html">
   6. Working With Dataframes Using pandas
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/pandas_subsetting.html">
     6.1. Subsetting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/pandas_aggregating.html">
     6.2. Aggregating
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/pandas_joining.html">
     6.3. Joining
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/pandas_transforming.html">
     6.4. Transforming
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/pandas_other_reps.html">
     6.5. How are Dataframes Different from Other Data Representations?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/pandas_summary.html">
     6.6. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../07/sql_intro.html">
   7. Working With Relations Using SQL
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/sql_subsetting.html">
     7.1. Subsetting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/sql_aggregating.html">
     7.2. Aggregating
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/sql_joining.html">
     7.3. Joining
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/sql_transforming.html">
     7.4. Transforming and Common Table Expressions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/sql_summary.html">
     7.5. Summary
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Understanding The Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../08/files_intro.html">
   8. Wrangling Files
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/files_datasets.html">
     8.1. Data Source Examples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/files_formats.html">
     8.2. File Formats
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/files_encoding.html">
     8.3. File Encoding
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/files_size.html">
     8.4. File Size
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/files_command_line.html">
     8.5. The Shell and Command Line Tools
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/files_granularity.html">
     8.6. Table Shape and Granularity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/files_summary.html">
     8.7. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../09/wrangling_intro.html">
   9. Wrangling Dataframes
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/wrangling_co2.html">
     9.1. Example: Wrangling CO2 Measurements from Mauna Loa Observatory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/wrangling_checks.html">
     9.2. Quality Checks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/wrangling_missing.html">
     9.3. Missing Values and Records
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/wrangling_transformations.html">
     9.4. Transformations and Timestamps
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/wrangling_structure.html">
     9.5. Modifying Structure
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/wrangling_restaurants.html">
     9.6. Example: Wrangling Restaurant Safety Violations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/wrangling_summary.html">
     9.7. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../10/eda_intro.html">
   10. Exploratory Data Analysis
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/eda_feature_types.html">
     10.1. Feature Types
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/eda_distributions.html">
     10.2. What to Look For in a Distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/eda_relationships.html">
     10.3. What to Look For in a Relationship
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/eda_multi.html">
     10.4. Comparisons in Multivariate Settings
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/eda_guidelines.html">
     10.5. Guidelines for Exploration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/eda_example.html">
     10.6. Example: Sale Prices for Houses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/eda_summary.html">
     10.7. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../11/viz_intro.html">
   11. Data Visualization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/viz_scale.html">
     11.1. Choosing Scale to Reveal Structure
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/viz_smoothing.html">
     11.2. Smoothing and Aggregating Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/viz_comparisons.html">
     11.3. Facilitating Meaningful Comparisons
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/viz_data_design.html">
     11.4. Incorporating the Data Design
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/viz_context.html">
     11.5. Adding Context
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/viz_plotly.html">
     11.6. Creating Plots Using
     <code class="docutils literal notranslate">
      <span class="pre">
       plotly
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/viz_other_tools.html">
     11.7. Other Tools for Visualization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/viz_summary.html">
     11.8. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../12/pa_intro.html">
   12. Case Study: How Accurate are Air Quality Measurements?
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../12/pa_scope.html">
     12.1. Question, Design, and Scope
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../12/pa_collocated.html">
     12.2. Finding Collocated Sensors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../12/pa_cleaning_aqs.html">
     12.3. Wrangling and Cleaning AQS Sensor Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../12/pa_cleaning_purpleair.html">
     12.4. Wrangling PurpleAir Sensor Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../12/pa_eda.html">
     12.5. Exploring PurpleAir and AQS Measurements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../12/pa_modeling.html">
     12.6. Creating a Model to Correct PurpleAir Measurements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../12/pa_conclusion.html">
     12.7. Summary
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Other Data Sources
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../13/text_intro.html">
   13. Working with Text
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../13/text_examples.html">
     13.1. Examples of Text and Tasks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../13/text_strings.html">
     13.2. String Manipulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../13/text_regex.html">
     13.3. Regular Expressions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../13/text_sotu.html">
     13.4. Text Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../13/text_summary.html">
     13.5. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="web_intro.html">
   14. Data Exchange
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="web_netCDF.html">
     14.1. NetCDF Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="web_json.html">
     14.2. JSON Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="web_http.html">
     14.3. HTTP
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="web_rest.html">
     14.4. REST
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     14.5. XML, HTML, and XPath
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="web_summary.html">
     14.6. Summary
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Linear Modeling
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../15/linear_intro.html">
   15. Linear Models
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/linear_simple.html">
     15.1. Simple Linear Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/linear_pa.html">
     15.2. Example: A Simple Linear Model for Air Quality
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/linear_simple_fit.html">
     15.3. Fitting the Simple Linear Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/linear_multi.html">
     15.4. Multiple Linear Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/linear_multi_fit.html">
     15.5. Fitting the Multiple Linear Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/linear_case.html">
     15.6. Example: Where is the Land of Opportunity?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/linear_feature_eng.html">
     15.7. Feature Engineering for Numeric Measurements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/linear_categorical.html">
     15.8. Feature Engineering for Categorical Measurements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/linear_summary.html">
     15.9. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../16/ms_intro.html">
   16. Model Selection
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../16/ms_overfitting.html">
     16.1. Overfitting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../16/ms_train_test.html">
     16.2. Train-Test Split
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../16/ms_cv.html">
     16.3. Cross-Validation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../16/ms_regularization.html">
     16.4. Regularization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../16/ms_risk.html">
     16.5. Model Bias and Variance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../16/ms_summary.html">
     16.6. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../17/inf_pred_gen_intro.html">
   17. Theory for Inference and Prediction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../17/inf_pred_gen_dist.html">
     17.1. Distributions: Population, Empirical, Sampling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../17/inf_pred_gen_HT.html">
     17.2. Basics of Hypothesis Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../17/inf_pred_gen_boot.html">
     17.3. Bootstrapping for Inference
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../17/inf_pred_gen_CI.html">
     17.4. Basics of Confidence Intervals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../17/inf_pred_gen_PI.html">
     17.5. Basics of Prediction Intervals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../17/inf_pred_gen_prob.html">
     17.6. Probability for Inference and Prediction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../17/inf_pred_gen_summary.html">
     17.7. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../18/donkey_intro.html">
   18. Case Study: How to Weigh a Donkey
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
  <label for="toctree-checkbox-18">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../18/donkey_scope.html">
     18.1. Donkey Study Question and Scope
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../18/donkey_clean.html">
     18.2. Wrangling and Transforming
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../18/donkey_eda.html">
     18.3. Exploring
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../18/donkey_model.html">
     18.4. Modeling a Donkey’s Weight
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../18/donkey_summary.html">
     18.5. Summary
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Classification
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../19/class_intro.html">
   19. Classification
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
  <label for="toctree-checkbox-19">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../19/class_example.html">
     19.1. Example: Wind Damaged Trees
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../19/class_pred.html">
     19.2. Modeling and Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../19/class_log_model.html">
     19.3. Modeling Proportions (and Probabilities)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../19/class_loss.html">
     19.4. A Loss Function for the Logistic Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../19/class_dr.html">
     19.5. From Probabilities to Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../19/class_summary.html">
     19.6. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../20/gd_intro.html">
   20. Numerical Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
  <label for="toctree-checkbox-20">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../20/gd_basics.html">
     20.1. Gradient Descent Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20/gd_example.html">
     20.2. Minimizing Huber Loss
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20/gd_convex.html">
     20.3. Convex and Differentiable Loss Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20/gd_alternative.html">
     20.4. Variants of Gradient Descent
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20/gd_summary.html">
     20.5. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../21/fake_news_intro.html">
   21. Case Study: Detecting Fake News
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
  <label for="toctree-checkbox-21">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../21/fake_news_question.html">
     21.1. Question and Scope
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../21/fake_news_data.html">
     21.2. Obtaining and Wrangling the Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../21/fake_news_exploring.html">
     21.3. Exploring the Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../21/fake_news_modeling.html">
     21.4. Modeling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../21/fake_news_summary.html">
     21.5. Summary
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Resources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../additional_resources.html">
   Additional Material
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../data_sources.html">
   Data Sources
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Appendices
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../a01/prob_review.html">
   Probability Review
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../a02/vector_space_review.html">
   Vector Space Review
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://datahub.berkeley.edu/hub/user-redirect/git-pull?repo=https%3A//github.com/ds-100/textbook&urlpath=tree/textbook/content/ch/14/web_html.ipynb&branch=master"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on JupyterHub"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_jupyterhub.svg">
  </span>
<span class="headerbtn__text-container">JupyterHub</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/ch/14/web_html.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-scraping-race-times-from-wikipedia">
   14.5.1. Example: Scraping Race Times from Wikipedia
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#xpath">
   14.5.2. XPath
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-accessing-exchange-rates-from-the-ecb">
   14.5.3. Example: Accessing Exchange Rates from the ECB
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>XML, HTML, and XPath</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-scraping-race-times-from-wikipedia">
   14.5.1. Example: Scraping Race Times from Wikipedia
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#xpath">
   14.5.2. XPath
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-accessing-exchange-rates-from-the-ecb">
   14.5.3. Example: Accessing Exchange Rates from the ECB
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="xml-html-and-xpath">
<h1><span class="section-number">14.5. </span>XML, HTML, and XPath<a class="headerlink" href="#xml-html-and-xpath" title="Permalink to this headline">#</a></h1>
<p>The eXtensible Markup Language (XML ) can represent all types of information, such as data sent to and from web services, including web pages, spreadsheets, visual displays like SVG, social network structures, word processing documents like MicroSoft’s docx, databases, and much more. As a data scientist, knowing a little about XML can come in handy.</p>
<p>Despite its name, XML is not itself a language. Rather, it is a very general structure we can use to define formats to represent and organize data. XML provides a basic structure and syntax for these “dialects” or vocabularies. If you read or composed HTML (HyperText Markup Language), you will recognize the format of XML.</p>
<p>The basic unit in XML is the <em>element</em>, which is also referred to as a <em>node</em>. An element has a name, and may have attributes, child elements, and text. The following annotated snippet of an XML plant catalog provides an example of these pieces (this content is adapted from <a class="reference external" href="https://www.w3schools.com/xml/plant_catalog.xml">W3 schools</a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;catalog&gt;                                The topmost node, aka root node.
    &lt;plant&gt;                              The first child of the root node.
        &lt;common&gt;Bloodroot&lt;/common&gt;       common is the first child of plant.
        &lt;botanical&gt;Sanguinaria canadensis&lt;/botanical&gt;
        &lt;zone&gt;4&lt;/zone&gt;                   This zone node has text content: 4.
        &lt;light&gt;Mostly Shady&lt;/light&gt;
        &lt;price curr=&quot;USD&quot;&gt;$2.44&lt;/price&gt;  This node has an attribute.
        &lt;availability date=&quot;0399&quot;/&gt;      Empty nodes can be collapsed.
    &lt;/plant&gt;                             Nodes must be closed. 
    &lt;plant&gt;                              The two plant nodes are siblings.
        &lt;common&gt;Columbine&lt;/common&gt;
        &lt;botanical&gt;Aquilegia canadensis&lt;/botanical&gt;
        &lt;zone&gt;3&lt;/zone&gt;
        &lt;light&gt;Mostly Shady&lt;/light&gt;
        &lt;price curr=&quot;CAD&quot;&gt;$9.37&lt;/price&gt;
        &lt;availability date=&quot;0199&quot;/&gt;
    &lt;/plant&gt;
&lt;/catalog&gt;
</pre></div>
</div>
<p>We added the indentation to this snippet of XML to make it easier to see the structure. It is not needed in the actual file.</p>
<p>XML documents are plain text files with the following syntax rules.</p>
<ul class="simple">
<li><p>Each element begins with a start-tag, like &lt;plant&gt;, and closes with an end-tag of the same name, like &lt;/plant&gt;.</p></li>
<li><p>XML elements can contain other XML elements.</p></li>
<li><p>XML elements can be plain text, like “Columbine” in &lt;common&gt;Columbine&lt;/common&gt;.</p></li>
<li><p>XML elements can have optional attributes. The element &lt;price curr=“CAD”&gt; has an attribute “curr” with value “CAD”.</p></li>
<li><p>In the special case when a node has no children, the end-tag can be folded into the start-tag. An example is the &lt;availability date=“0199”/&gt;.</p></li>
</ul>
<p>We call an XML document well-formed when it follows certain rules. The most important of these are:</p>
<ul class="simple">
<li><p>One root node contains all of the other elements in the document.</p></li>
<li><p>Elements nest properly; an open node closes around all of its children and no more.</p></li>
<li><p>Tag names are case sensitive.</p></li>
<li><p>Attribute values have a name=“value” format with single or double quotes.</p></li>
</ul>
<p>There are additional rules for a document to be well-formed. These relate to white-space, special characters, naming conventions, and repeated attributes.</p>
<p>The hierarchical nature of well-formed XML means it can be represented as a tree. <a class="reference internal" href="#fig-xml-tree"><span class="std std-numref">Figure 14.4</span></a> shows a tree representation of the plant catalog XML.</p>
<figure class="align-default" id="fig-xml-tree">
<img alt="../../_images/catalog-tree.png" src="../../_images/catalog-tree.png" />
<figcaption>
<p><span class="caption-number">Fig. 14.4 </span><span class="caption-text">Hierarchy of an XML document. The lighter grey boxes represent text elements. By design these cannot have child nodes.</span><a class="headerlink" href="#fig-xml-tree" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Like with JSON, an XML document is plain text. We can read it with a plain-text viewer, and it’s easy for machines to read and create XML content.  The extensible nature of XML allows content to be easily merged into higher-level container documents and easily exchanged with other applications. XML also supports binary data and arbitrary character sets.</p>
<p>As mentioned already, HTML looks a lot like XML. That’s no accident, and indeed, XHTML is a subset of HTML that follows the rules of well-formed XML. Let’s return to our earlier example of the Wikipedia page that we retrieved from the Internet and show how to used XML tools to create a data frame from the contents of one of its tables.</p>
<section id="example-scraping-race-times-from-wikipedia">
<h2><span class="section-number">14.5.1. </span>Example: Scraping Race Times from Wikipedia<a class="headerlink" href="#example-scraping-race-times-from-wikipedia" title="Permalink to this headline">#</a></h2>
<p>Earlier in this chapter, we used an HTTP request to retrieve the HTML page from Wikipedia shown in <a class="reference internal" href="web_http.html#fig-wiki-1500"><span class="std std-numref">Figure 14.3</span></a>. The contents of this page are in HTML, which is essentially an XML vocabulary.  We can use the hierarchical structure of the page and XML tools to access data in one of the tables and wrangle into a data frame. In particular, we are interested in the second table in the page, a portion of it appears in the screen shot in <a class="reference internal" href="#fig-html-table"><span class="std std-numref">Figure 14.5</span></a>.</p>
<figure class="align-default" id="fig-html-table">
<img alt="../../_images/wiki-table-1500.jpg" src="../../_images/wiki-table-1500.jpg" />
<figcaption>
<p><span class="caption-number">Fig. 14.5 </span><span class="caption-text">Screenshot of the second table in a web page that contains the data we want to extract.</span><a class="headerlink" href="#fig-html-table" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Before we work on this table, we provide a quick summary of the format for a basic  HTML table. Below is the HTML for a table with a header and two rows of three columns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">table</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">tbody</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">A</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">B</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">C</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span> 
  <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="mi">3</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="mi">5</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="mi">6</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="mi">7</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">tbody</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Notice how the table is laid out in rows with &lt;tr&gt; elements, and each cell in a row is a &lt;td&gt; element that contains the text to be displayed in the table.</p>
<p>Our first task is to create a tree structure from the content of the web page. To do this, we use the <code class="docutils literal notranslate"><span class="pre">lxml</span></code> library, which provides access to the C-library <code class="docutils literal notranslate"><span class="pre">libxml2</span></code> for handling XML content. Recall that resp_1500 contains the response from our request, and the page is in the body of the response. We can parse the web page into a hierarchical structure with <code class="docutils literal notranslate"><span class="pre">fromstring</span></code> in the <code class="docutils literal notranslate"><span class="pre">lxml.html</span></code> module:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">html</span>

<span class="n">tree_1500</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">resp_1500</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">tree_1500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>lxml.html.HtmlElement
</pre></div>
</div>
</div>
</div>
<p>Now we can work with the document using its tree structure. We can find all the tables in the HTML document with the following search:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tables</span> <span class="o">=</span> <span class="n">tree_1500</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//table&#39;</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>list
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6
</pre></div>
</div>
</div>
</div>
<p>This search uses the XPath <code class="docutils literal notranslate"><span class="pre">//table</span></code> expression, which we soon describe, to search for all table nodes anywhere in the document.</p>
<p>We found six tables in the document. If we examine the web page, including looking at its HTML source via the browser, we can figure out that the second table in the document contains the IAF-era times. This is the table we want. The screenshot in <a class="reference internal" href="#fig-html-table"><span class="std std-numref">Figure 14.5</span></a> shows that the first column contains the race times, the third holds names, and the fourth has the dates of the races. We can extract each of these pieces of information in turn. We do this with the following XPath expressions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">times</span> <span class="o">=</span> <span class="n">tree_1500</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//table[2]/tbody/tr/td[1]/b/text()&#39;</span><span class="p">)</span>
<span class="n">names</span> <span class="o">=</span> <span class="n">tree_1500</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//table[2]/tbody/tr/td[3]/a/text()&#39;</span><span class="p">)</span>
<span class="n">dates</span> <span class="o">=</span> <span class="n">tree_1500</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//table[2]/tbody/tr/td[4]/text()&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>lxml.etree._ElementUnicodeResult
</pre></div>
</div>
</div>
</div>
<p>These return values behave like a list, but each value is an element of the tree. We can convert them to strings:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">date_str</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">]</span>
<span class="n">name_str</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>For the times, we want to transform them into seconds. The function <code class="docutils literal notranslate"><span class="pre">get_sec</span></code> does this conversion. And, we want to extract the race year from the date string:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_sec</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;convert time into seconds.&quot;&quot;&quot;</span>
    <span class="n">time</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_sec</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_sec</span><span class="p">(</span><span class="n">rt</span><span class="p">)</span> <span class="k">for</span> <span class="n">rt</span> <span class="ow">in</span> <span class="n">times</span><span class="p">]</span>
<span class="n">race_year</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">date_str</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">men_1500</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;race_time&quot;</span><span class="p">:</span><span class="n">time_sec</span><span class="p">,</span> <span class="s2">&quot;athlete&quot;</span><span class="p">:</span><span class="n">name_str</span><span class="p">,</span> 
                         <span class="s2">&quot;year&quot;</span><span class="p">:</span><span class="n">race_year</span><span class="p">})</span>

<span class="n">men_1500</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>race_time</th>
      <th>athlete</th>
      <th>year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>235.80</td>
      <td>Abel Kiviat</td>
      <td>1912</td>
    </tr>
    <tr>
      <th>1</th>
      <td>234.70</td>
      <td>John Zander</td>
      <td>1917</td>
    </tr>
    <tr>
      <th>2</th>
      <td>232.60</td>
      <td>Paavo Nurmi</td>
      <td>1924</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>35</th>
      <td>208.86</td>
      <td>Noureddine Morceli</td>
      <td>1992</td>
    </tr>
    <tr>
      <th>36</th>
      <td>207.37</td>
      <td>Noureddine Morceli</td>
      <td>1995</td>
    </tr>
    <tr>
      <th>37</th>
      <td>206.00</td>
      <td>Hicham El Guerrouj</td>
      <td>1998</td>
    </tr>
  </tbody>
</table>
<p>38 rows × 3 columns</p>
</div></div></div>
</div>
<p>We can create a data frame and make a plot to show the progress in race times over the years:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">men_1500</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;race_time&#39;</span><span class="p">,</span>
           <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;year&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;race_time&#39;</span><span class="p">:</span><span class="s1">&#39;Time (sec)&#39;</span><span class="p">},</span>
           <span class="n">width</span><span class="o">=</span><span class="mi">450</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/web_html_33_0.svg" src="../../_images/web_html_33_0.svg" /></div>
</div>
<p>As you may have noticed, extracting data from an HTML page relies on careful examination of the source to find where in the document are the numbers that we’re after. We relied heavily on the XPath tool to do the extraction. Its elegant language is quite powerful. We introduce it next.</p>
</section>
<section id="xpath">
<h2><span class="section-number">14.5.2. </span>XPath<a class="headerlink" href="#xpath" title="Permalink to this headline">#</a></h2>
<p>When we work with XML documents, we typically want to extract data from them and bring it into a data frame. XPath can help here. XPath can recursively traverse an XML tree to find elements. For example, we used the expression <code class="docutils literal notranslate"><span class="pre">//table</span></code> in the previous example to locate all table nodes in our web page.</p>
<p>XPath expressions operate on the hierarchy of well-formed XML. They are succinct and similar in format to the way files are located in a hierarchy of directories in a computer file system. But, they’re much more powerful. XPath is also similar to regular expressions in that we specify patterns to match content. Like with regular expressions, it takes experience to compose correct XPath expressions.</p>
<p>An XPath expression forms logical steps to identify and filter nodes in a tree. The result is a <em>node-set</em> where each node occurs at most once. The node-set also has an order that matches the order in which the nodes occur in the source; this can be quite handy.</p>
<p>Each XPath expression is made up of one or more <em>location steps</em>, separated by a “/”. Each location step has three parts, the <em>axis</em>, <em>node-test</em>, and optional <em>predicate</em>.</p>
<ul class="simple">
<li><p>The axis specifies the direction to look in, such as down, up or across the tree. We exclusively use shortcuts for the axis. The default is to look down one step at children in the tree, <code class="docutils literal notranslate"><span class="pre">//</span></code> says to look down the tree as far as possible, and <code class="docutils literal notranslate"><span class="pre">..</span></code> indicates one step up to the parent.</p></li>
<li><p>The node-test identifies the name or the type of node to look for. This is typically just a tag name or <code class="docutils literal notranslate"><span class="pre">text()</span></code> for text elements.</p></li>
<li><p>A predicate acts like a filter to further restrict the node-set. These are given in square brackets, like <code class="docutils literal notranslate"><span class="pre">[2]</span></code> which keeps the second node in the node-set, and <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">&#64;date</span> <span class="pre">]</span></code> which keeps all nodes with a date attribute.</p></li>
</ul>
<p>We can tack together location steps to create powerful search instructions. <a class="reference internal" href="#xpath-examples"><span class="std std-numref">Table 14.2</span></a> provides some examples that cover the most common expressions. Refer back to the tree in <a class="reference internal" href="#fig-xml-tree"><span class="std std-numref">Figure 14.4</span></a> to follow along.</p>
<table class="colwidths-auto table" id="xpath-examples">
<caption><span class="caption-number">Table 14.2 </span><span class="caption-text">XPath Examples</span><a class="headerlink" href="#xpath-examples" title="Permalink to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Expression</p></th>
<th class="head"><p>Result</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>‘//common’</p></td>
<td><p>two nodes</p></td>
<td><p>Look all down the tree for any common nodes.</p></td>
</tr>
<tr class="row-odd"><td><p>‘/catalog/plant/common’</p></td>
<td><p>two nodes</p></td>
<td><p>Travel the specific path from the root node <em>catalog</em> to all plant nodes to all common nodes within the plant nodes.</p></td>
</tr>
<tr class="row-even"><td><p>‘//common/text()’</p></td>
<td><p>Bloodroot, Columbine</p></td>
<td><p>Locate the text content of all common nodes.</p></td>
</tr>
<tr class="row-odd"><td><p>‘//plant[2]/price/text()’</p></td>
<td><p>$9.37</p></td>
<td><p>Locate plant nodes anywhere in the tree, then filter to take only the second. From this plant node travel to its price child and locate its text.</p></td>
</tr>
<tr class="row-even"><td><p>‘//&#64;date’</p></td>
<td><p>0399, 0199</p></td>
<td><p>Locate the attribute value of any attribute named “date” in the tree.</p></td>
</tr>
<tr class="row-odd"><td><p>‘//price[&#64;curr=“CAD”]/text()’</p></td>
<td><p>$9.37</p></td>
<td><p>The text content of any price node that has a currency attribute value of “CAD”.</p></td>
</tr>
</tbody>
</table>
<p>You can try out the XPath expressions in the table with the catalog file. We load the file into Python using the <code class="docutils literal notranslate"><span class="pre">etree</span></code> module. The <code class="docutils literal notranslate"><span class="pre">parse</span></code> method reads the file into an element tree.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">catalog</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;data/catalog.xml&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">lxml</span></code> library gives us access to XPath. Let’s try it out.</p>
<p>Below is a simple XPath expression to locate all text content of any &lt;light&gt; node in the tree:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">catalog</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//light/text()&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Mostly Shady&#39;, &#39;Mostly Shady&#39;]
</pre></div>
</div>
</div>
</div>
<p>Notice that two elements are returned. Although the text content is identical, we have two &lt;light&gt; nodes in our tree and so are given the text content of each. The following expression is a bit more challenging:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">catalog</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//price[@curr=&quot;CAD&quot;]/../common/text()&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Columbine&#39;]
</pre></div>
</div>
</div>
</div>
<p>The expression locates all “price” nodes in the tree, then filters them according to whether their “curr” attribute is “CAD”. Then for the remaining nodes (there’s only one in this case), travel up one step in the tree to the parent node and then back down to any child “common” nodes and on to their text content. Quite the trip!</p>
<p>Next, we provide an example that uses an HTTP request to retrieve XML-formatted data, and XPath to wrangle the content into a data frame.</p>
</section>
<section id="example-accessing-exchange-rates-from-the-ecb">
<h2><span class="section-number">14.5.3. </span>Example: Accessing Exchange Rates from the ECB<a class="headerlink" href="#example-accessing-exchange-rates-from-the-ecb" title="Permalink to this headline">#</a></h2>
<p>The European Central Bank (ECB) makes exchange rates available online in an XML format. Let’s begin by getting the most recent exchange rates from the ECB with an HTTP request:</p>
<div class="cell tag_student docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url_base</span> <span class="o">=</span> <span class="s1">&#39;https://www.ecb.europa.eu/stats/eurofxref/&#39;</span>
<span class="n">url2</span> <span class="o">=</span> <span class="s1">&#39;eurofxref-hist-90d.xml?d574942462c9e687c3235ce020466aae&#39;</span>
<span class="n">resECB</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_base</span><span class="o">+</span><span class="n">url2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resECB</span><span class="o">.</span><span class="n">status_code</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>200
</pre></div>
</div>
</div>
</div>
<p>Again, we can use the <code class="docutils literal notranslate"><span class="pre">lxml</span></code> library to parse the text document we received from the ECB, but this time the contents are in a string returned to us from the ECB, not a file:</p>
<div class="cell tag_solution docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ecb_tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">resECB</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In order to extract the data we want, we need to know how it is organized.  Below is a snippet of the content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">gesmes</span><span class="p">:</span><span class="n">Envelope</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">gesmes</span><span class="o">=</span><span class="s2">&quot;http://www.gesmes.org/xml/2002-08-01&quot;</span>
        <span class="n">xmlns</span><span class="o">=</span><span class="s2">&quot;http://www.ecb.int/vocabulary/2002-08-01/eurofxref&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">gesmes</span><span class="p">:</span><span class="n">subject</span><span class="o">&gt;</span><span class="n">Reference</span> <span class="n">rates</span><span class="o">&lt;/</span><span class="n">gesmes</span><span class="p">:</span><span class="n">subject</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">gesmes</span><span class="p">:</span><span class="n">Sender</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">gesmes</span><span class="p">:</span><span class="n">name</span><span class="o">&gt;</span><span class="n">European</span> <span class="n">Central</span> <span class="n">Bank</span><span class="o">&lt;/</span><span class="n">gesmes</span><span class="p">:</span><span class="n">name</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">gesmes</span><span class="p">:</span><span class="n">Sender</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">Cube</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">Cube</span> <span class="n">time</span><span class="o">=</span><span class="s2">&quot;2023-02-24&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">Cube</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span> <span class="n">rate</span><span class="o">=</span><span class="s2">&quot;1.057&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">Cube</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;JPY&quot;</span> <span class="n">rate</span><span class="o">=</span><span class="s2">&quot;143.55&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">Cube</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;BGN&quot;</span> <span class="n">rate</span><span class="o">=</span><span class="s2">&quot;1.9558&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">Cube</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">Cube</span> <span class="n">time</span><span class="o">=</span><span class="s2">&quot;2023-02-23&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">Cube</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span> <span class="n">rate</span><span class="o">=</span><span class="s2">&quot;1.0616&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">Cube</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;JPY&quot;</span> <span class="n">rate</span><span class="o">=</span><span class="s2">&quot;143.32&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">Cube</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;BGN&quot;</span> <span class="n">rate</span><span class="o">=</span><span class="s2">&quot;1.9558&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">Cube</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">Cube</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">gesmes</span><span class="p">:</span><span class="n">Envelope</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This document appears quite different in structure from the plant catalog. The snippet shows three levels of tags all with the same name, and none have text content. All of the relevant information is contained in attribute values. Another new feature are the terms “xmlns” in the root “Envelope” node, and the odd tag-names like “gesmes:Envelope”.  These have to do with namespaces.</p>
<p>XML allows content creators to use their own vocabularies, called <em>namespaces</em>. The namespace gives the rules for a vocabulary, such as allowable tag names and attribute names, and restrictions on how nodes can be nested. And, XML documents can merge vocabularies from different applications. To keep it all straight, information about the namespace(s) are provided in the document.</p>
<p>The root node in the ECB file is &lt;Envelope&gt;. The additional “gesmes:” in the tag-name indicates that the tags belong to the gesmes vocabulary, which is an international standard for the exchange of time series information. Another namespace is also in &lt;Envelope&gt;. It is the default namespace for the file because it doesn’t have a prefix, like “gesmes:”. Whenever a namespace is not provided in a tag-name, the default is assumed.</p>
<p>The upshot of this is that we need take into account these namespaces when we search for nodes. Let’s see how this works when we extract the dates. From the snippet, we see that the dates reside in “time” attributes. These &lt;Cube&gt;s are children of the top &lt;Cube&gt;. We can give a very specific XPath expression to step from the root to its &lt;Cube&gt; child node and on to the next level of &lt;Cube&gt; nodes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">namespaceURI</span> <span class="o">=</span> <span class="s1">&#39;http://www.ecb.int/vocabulary/2002-08-01/eurofxref&#39;</span>

<span class="n">date</span> <span class="o">=</span> <span class="n">ecb_tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;./x:Cube/x:Cube/@time&#39;</span><span class="p">,</span> <span class="n">namespaces</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">namespaceURI</span><span class="p">})</span>
<span class="n">date</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;2023-05-26&#39;, &#39;2023-05-25&#39;, &#39;2023-05-24&#39;, &#39;2023-05-23&#39;, &#39;2023-05-22&#39;]
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">.</span></code> in the expression is a shortcut to signify “from here” and since we’re at the top of the tree, it’s equivalent to “from the root”. We specified the namespace in our expression as “x:”. Even though, the &lt;Cube&gt; nodes are using the default namespace, we must specify it in our XPath expression. Fortunately, we can simply pass in the namespace as a parameter with our own label (“x” in this case) to keep our tag-names short.</p>
<p>Like with the HTML table, we can convert the date values into strings and from strings into timestamps:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">date_str</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">date</span><span class="p">]</span>
<span class="n">timestamps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">date_str</span><span class="p">,</span> <span class="n">infer_datetime_format</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">xrates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;date&quot;</span><span class="p">:</span><span class="n">timestamps</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>As for the exchange rates, they also appear in &lt;Cube&gt; nodes, but these have a “rate” attribute. For example, we can access all exchange rates for the British pound with the following XPath expression (we’re ignoring the namespace for the moment):</p>
<p><code class="docutils literal notranslate"><span class="pre">//Cube[&#64;currency</span> <span class="pre">=</span> <span class="pre">&quot;GBP&quot;]/&#64;rate</span></code></p>
<p>This expression says: look for all &lt;Cube&gt; nodes anywhere in the document, filter them according to whether the node has a currency attribute value of “GBP”, and return their rate attribute values.</p>
<p>Since we want to extract exchange rates for multiple currencies, we generalize this XPath expression. We also want to convert the exchange rates to a numeric storage type, and make them relative to the first day’s rate so the different currencies are on the same scale, which makes them more amenable for plots:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">currs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GBP&#39;</span><span class="p">,</span> <span class="s1">&#39;USD&#39;</span><span class="p">,</span> <span class="s1">&#39;CAD&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">ctry</span> <span class="ow">in</span> <span class="n">currs</span><span class="p">:</span>
    <span class="n">expr</span> <span class="o">=</span> <span class="s1">&#39;.//x:Cube[@currency = &quot;&#39;</span> <span class="o">+</span> <span class="n">ctry</span> <span class="o">+</span> <span class="s1">&#39;&quot;]/@rate&#39;</span>
    <span class="n">rates</span> <span class="o">=</span> <span class="n">ecb_tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">namespaces</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">namespaceURI</span><span class="p">})</span>
    <span class="n">rates_num</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span> <span class="k">for</span> <span class="n">rate</span> <span class="ow">in</span> <span class="n">rates</span><span class="p">]</span>
    <span class="n">first</span> <span class="o">=</span> <span class="n">rates_num</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">rates_num</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">xrates</span><span class="p">[</span><span class="n">ctry</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">rate</span> <span class="o">/</span> <span class="n">first</span> <span class="k">for</span> <span class="n">rate</span> <span class="ow">in</span> <span class="n">rates_num</span><span class="p">]</span>  
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xrates</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>GBP</th>
      <th>USD</th>
      <th>CAD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2023-05-26</td>
      <td>0.99</td>
      <td>1.02</td>
      <td>1.02</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2023-05-25</td>
      <td>0.99</td>
      <td>1.02</td>
      <td>1.02</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2023-05-24</td>
      <td>0.99</td>
      <td>1.02</td>
      <td>1.02</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2023-05-23</td>
      <td>0.99</td>
      <td>1.02</td>
      <td>1.02</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2023-05-22</td>
      <td>0.99</td>
      <td>1.03</td>
      <td>1.02</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We wrap up this example with line plots of the exchange rates:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">xrates</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;USD&quot;</span><span class="p">,</span> <span class="s2">&quot;CAD&quot;</span><span class="p">,</span> <span class="s2">&quot;GBP&quot;</span><span class="p">],</span>
             <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span>
             <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Exchange Rate with the Euro&quot;</span><span class="p">,</span> 
             <span class="n">width</span><span class="o">=</span><span class="mi">650</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Exchange rate relative to first day&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">legend_title_text</span><span class="o">=</span><span class="s1">&#39;Currency&#39;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span>         
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/web_html_67_0.svg" src="../../_images/web_html_67_0.svg" /></div>
</div>
<p>Combining knowledge of JSON, HTTP, REST, and HTML gives us access to a vast
variety of data available on the web. For example, in this section we wrote code to scrape data from a Wikipedia page. One key advantage of this approach is that we can likely rerun this code in a few months to automatically update the data and the plots. One key drawback is that our approach is tightly coupled to the structure of the webpage—if someone updates the Wikipedia page and the table is no longer the second table on the page, our code will also need some edits in order to work.
That said, having the skills needed to scrape data from the web opens the door to a wide range of data and enables all kinds of useful analyses.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./ch/14"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="web_rest.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">14.4. </span>REST</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="web_summary.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">14.6. </span>Summary</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Sam Lau, Joey Gonzalez, and Deb Nolan<br/>
  
      &copy; Copyright 2023.<br/>
    <div class="extra_footer">
      <p>
License: CC BY-NC-ND 4.0
</p>

    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>