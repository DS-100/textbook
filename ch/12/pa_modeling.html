
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>12.4. Creating a Model to Correct PurpleAir Measurements &#8212; Learning Data Science</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/custom.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="12.5. In Conclusion" href="pa_conclusion.html" />
    <link rel="prev" title="12.3. Exploring and Cleaning PurpleAir Sensor Data" href="pa_cleaning_purpleair.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-113006011-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Learning Data Science</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  Frontmatter
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../preface.html">
   To the Data 100 Student
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../prereqs.html">
   Prerequisites
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../notation.html">
   Notation
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  The Data Science Lifecycle
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01/lifecycle_intro.html">
   1. The Data Science Lifecycle
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/lifecycle_cycle.html">
     1.1. The Stages of the Lifecycle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/lifecycle_map.html">
     1.2. Chapter Map to the Lifecycle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/lifecycle_summary.html">
     1.3. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02/data_scope_intro.html">
   2. Questions and Data Scope
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data_scope_big_data_hubris.html">
     2.1. Big Data and New Opportunities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data_scope_construct.html">
     2.2. Target Population, Access Frame, Sample
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data_scope_protocols.html">
     2.3. Instruments and Protocols
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data_scope_natural.html">
     2.4. Measuring Natural Phenomenon
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data_scope_accuracy.html">
     2.5. Accuracy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data_scope_summary.html">
     2.6. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data_scope_exercises.html">
     2.7. Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03/theory_intro.html">
   3. Simulation and Data Design
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/theory_urn.html">
     3.1. The Urn Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/theory_election.html">
     3.2. Simulating Election Polls: Bias, Variance, and Big Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/theory_vaccine_efficacy.html">
     3.3. Simulating a Randomized Trial: Vaccine Efficacy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/theory_measurement_error.html">
     3.4. Measurement Error: Air Quality Variation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/theory_summary.html">
     3.5. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/theory_exercises.html">
     3.6. Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04/modeling_intro.html">
   4. Modeling and Summary Statistics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/modeling_simple.html">
     4.1. The Constant Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/modeling_loss_functions.html">
     4.2. Loss Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/modeling_summary.html">
     4.3. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/modeling_exercises.html">
     4.4. Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../05/cycle_case_study_intro.html">
   5. Case Study: Why is my Bus Always Late?
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Rectangular Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../06/pandas_intro.html">
   6. Working With Dataframes Using pandas
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/pandas_subsetting.html">
     6.1. Subsetting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/pandas_aggregating.html">
     6.2. Aggregating
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/pandas_joining.html">
     6.3. Joining
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/pandas_transforming.html">
     6.4. Transforming
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/pandas_other_reps.html">
     6.5. How are Dataframes Different from Other Data Representations?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/pandas_summary.html">
     6.6. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/pandas_exercises.html">
     6.7. Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../07/sql_intro.html">
   7. Working With Relations Using SQL
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/sql_subsetting.html">
     7.1. Subsetting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/sql_aggregating.html">
     7.2. Aggregating
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/sql_joining.html">
     7.3. Joining
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/sql_transforming.html">
     7.4. Transforming
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/sql_other_reps.html">
     7.5. How are Relations Different from Other Data Representations?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/sql_summary.html">
     7.6. Conclusion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/sql_exercises.html">
     7.7. Exercises
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Understanding The Data
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../08/files_intro.html">
   8. Wrangling Files
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/files_datasets.html">
     8.1. Data Source Examples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/files_formats.html">
     8.2. File Formats
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/files_size.html">
     8.3. File Size
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/files_command_line.html">
     8.4. The Shell and Command Line Tools
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/files_granularity.html">
     8.5. Table Shape and Granularity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/files_summary.html">
     8.6. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../09/wrangling_intro.html">
   9. Wrangling Dataframes
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/wrangling_co2.html">
     9.1. Example: Wrangling CO2 Measurements from Mauna Loa Observatory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/wrangling_checks.html">
     9.2. Quality Checks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/wrangling_missing.html">
     9.3. Missing Values and Records
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/wrangling_transformations.html">
     9.4. Transformations and Timestamps
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/wrangling_structure.html">
     9.5. Modifying Structure
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/wrangling_restaurants.html">
     9.6. Example: Wrangling Restaurant Safety Violations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/wrangling_summary.html">
     9.7. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../10/eda_intro.html">
   10. Exploratory Data Analysis
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/eda_feature_types.html">
     10.1. Feature Types
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/eda_distributions.html">
     10.2. What to Look For in a Distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/eda_relationships.html">
     10.3. What to Look For in a Relationship?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/eda_guidelines.html">
     10.4. Guidelines for Exploration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/eda_example.html">
     10.5. Example: Sale Prices for Houses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/eda_summary.html">
     10.6. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../11/viz_intro.html">
   11. Data Visualization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/viz_scale.html">
     11.1. Choosing Scale to Reveal Structure
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/viz_smoothing.html">
     11.2. Smoothing and Aggregating Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/viz_comparisons.html">
     11.3. Facilitating Meaningful Comparisons
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/viz_data_design.html">
     11.4. Incorporating the Data Design
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/viz_context.html">
     11.5. Adding Context
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/viz_plotly.html">
     11.6. Creating Plots Using
     <code class="docutils literal notranslate">
      <span class="pre">
       plotly
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/viz_other_tools.html">
     11.7. Other Tools for Visualization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11/viz_summary.html">
     11.8. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="pa_intro.html">
   12. Case Study: Data Science for Accurate and Timely Air Quality Measurements
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="pa_collocated.html">
     12.1. Finding Collocated Sensors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pa_cleaning_aqs.html">
     12.2. Exploring and Cleaning AQS Sensor Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pa_cleaning_purpleair.html">
     12.3. Exploring and Cleaning PurpleAir Sensor Data
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     12.4. Creating a Model to Correct PurpleAir Measurements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pa_conclusion.html">
     12.5. In Conclusion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pa_exercises.html">
     12.6. Exercises
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Other Data Sources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../13/text_intro.html">
   13. Working with Text
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../13/text_examples.html">
     13.1. Examples of Text and Tasks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../13/text_strings.html">
     13.2. String Manipulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../13/text_regex.html">
     13.3. Regular Expressions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../13/text_sotu.html">
     13.4. Text Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../13/text_summary.html">
     13.5. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../13/text_exercises.html">
     13.6. Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../14/web_intro.html">
   14. Web Technologies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../14/web_http.html">
     14.1. HTTP
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../14/web_rest.html">
     14.2. [In Progress] REST
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../14/web_html.html">
     14.3. [In Progress] XPath and HTML
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Linear Modeling
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../15/linear_intro.html">
   15. Linear Models
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/linear_simple.html">
     15.1. Simple Linear Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/linear_simple_fit.html">
     15.2. Fitting the Simple Linear Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/linear_multi.html">
     15.3. Multiple Linear Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/linear_multi_fit.html">
     15.4. Fitting the Multiple Linear Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/linear_case.html">
     15.5. Example: Where is the Land of Opportunity?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/linear_feature_eng.html">
     15.6. Feature Engineering for Numeric Measurements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/linear_categorical.html">
     15.7. Feature Engineering for Categorical Measurements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/linear_summary.html">
     15.8. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/linear_exercises.html">
     15.9. Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../16/inf_pred_gen_intro.html">
   16. Theory for Inference and Prediction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../16/inf_pred_gen_dist.html">
     16.1. Distributions: Population, Empirical, Sampling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../16/inf_pred_gen_HT.html">
     16.2. Basics of Hypothesis Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../16/inf_pred_gen_boot.html">
     16.3. Bootstrapping for Inference
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../16/inf_pred_gen_CI.html">
     16.4. Basics of Confidence Intervals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../16/inf_pred_gen_PI.html">
     16.5. Basics of Prediction Intervals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../16/inf_pred_gen_prob.html">
     16.6. Probability for Inference and Prediction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../16/inf_pred_gen_summary.html">
     16.7. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../16/inf_pred_gen_Exercises.html">
     16.8. Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../17/risk_intro.html">
   17. Loss, Risk, and Model Selection
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../18/donkey_intro.html">
   18. Case Study: How to Weigh a Donkey
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../18/donkey_scope.html">
     18.1. Donkey Study Question and Scope
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../18/donkey_clean.html">
     18.2. Wrangling and Transforming
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../18/donkey_eda.html">
     18.4. Exploring
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../18/donkey_model.html">
     18.5. Modeling a Donkey’s Weight
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../18/donkey_summary.html">
     18.6. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../18/donkey_exercises.html">
     18.7. Exercises
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Classification
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../19/classification_intro.html">
   19. Classification
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../19/classification_prob.html">
     19.1. Regression on Probabilities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../19/classification_log_model.html">
     19.2. The Logistic Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../19/classification_cost.html">
     19.3. A Loss Function for the Logistic Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../19/classification_log_reg.html">
     19.4. Using Logistic Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../19/classification_cost_justification.html">
     19.5. Approximating the Empirical Probability Distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../19/classification_sgd.html">
     19.6. Fitting a Logistic Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../19/classification_sensitivity_specificity.html">
     19.7. Evaluating Logistic Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../19/classification_multiclass.html">
     19.8. Multiclass Classification
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../20/gradient_descent.html">
   20. Gradient Descent and Numerical Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
  <label for="toctree-checkbox-18">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../20/gradient_basics.html">
     20.1. Loss Minimization Using a Program
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20/gradient_descent_define.html">
     20.2. Gradient Descent
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20/gradient_convexity.html">
     20.3. Convexity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20/gradient_stochastic.html">
     20.4. Stochastic Gradient Descent
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20/gradient_lin_reg.html">
     20.5. Fitting a Linear Model Using Gradient Descent
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Extra Topics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../21/repl_intro.html">
   21. Replicable Research
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
  <label for="toctree-checkbox-19">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../21/repl_phacking.html">
     21.1. P-hacking
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../22/pca_intro.html">
   22. Dimensionality Reduction and PCA
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
  <label for="toctree-checkbox-20">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../22/pca_dims.html">
     22.1. Dimensions of a Data Table
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../22/pca_svd.html">
     22.2. PCA using the Singular Value Decomposition
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../22/pca_in_practice.html">
     22.3. PCA in Practice
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../23/dtrees_intro.html">
   23. Decision Trees and Random Forests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../24/clustering_intro.html">
   24. Clustering
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Appendices
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../a01/prob_review.html">
   Probability Review
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../a02/vector_space_review.html">
   Vector Space Review
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../a03/hyp_intro.html">
   Statistical Inference Review
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
  <label for="toctree-checkbox-21">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../a03/hyp_introduction.html">
     Hypothesis Testing and Confidence Intervals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../a03/hyp_introduction_part2.html">
     Permutation Test
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../a04/ref_intro.html">
   Reference Tables
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
  <label for="toctree-checkbox-22">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../a04/ref_pandas.html">
     pandas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../a04/ref_seaborn.html">
     Seaborn
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../a04/ref_matplotlib.html">
     matplotlib
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../a04/ref_sklearn.html">
     scikit-learn
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../a05/bias_intro.html">
   The Bias-Variance Tradeoff
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
  <label for="toctree-checkbox-23">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../a05/bias_risk.html">
     Risk and Loss Minimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../a05/bias_modeling.html">
     Model Bias and Variance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../a05/bias_cv.html">
     Cross-Validation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../a06/reg_intro.html">
   Regularization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/>
  <label for="toctree-checkbox-24">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../a06/reg_intuition.html">
     Regularization Intuition
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../a06/reg_ridge.html">
     L2 Regularization: Ridge Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../a06/reg_lasso.html">
     L1 Regularization: Lasso Regression
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../a07/contributors.html">
   Contributors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../references.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/ch/12/pa_modeling.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        <a class="jupyterhub-button" href="https://datahub.berkeley.edu/hub/user-redirect/git-pull?repo=https://github.com/ds-100/textbook&urlpath=tree/textbook/content/ch/12/pa_modeling.ipynb&branch=master"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-in-the-data">
   12.4.1. Loading in the Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#our-modeling-procedure">
   12.4.2. Our Modeling Procedure
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-1-a-simple-constant-model">
   12.4.3. Model 1: A Simple Constant Model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-2-adjusting-purpleair-by-a-constant">
   12.4.4. Model 2: Adjusting PurpleAir by a Constant
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-did-model-2-perform-worse">
     12.4.4.1. Why Did Model 2 Perform Worse?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-3-simple-linear-regression">
   12.4.5. Model 3: Simple Linear Regression
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-a-linear-model-for-calibration">
     12.4.5.1. Using a Linear Model for Calibration
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-4-incorporating-relative-humidity">
   12.4.6. Model 4: Incorporating Relative Humidity
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Creating a Model to Correct PurpleAir Measurements</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-in-the-data">
   12.4.1. Loading in the Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#our-modeling-procedure">
   12.4.2. Our Modeling Procedure
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-1-a-simple-constant-model">
   12.4.3. Model 1: A Simple Constant Model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-2-adjusting-purpleair-by-a-constant">
   12.4.4. Model 2: Adjusting PurpleAir by a Constant
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-did-model-2-perform-worse">
     12.4.4.1. Why Did Model 2 Perform Worse?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-3-simple-linear-regression">
   12.4.5. Model 3: Simple Linear Regression
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-a-linear-model-for-calibration">
     12.4.5.1. Using a Linear Model for Calibration
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-4-incorporating-relative-humidity">
   12.4.6. Model 4: Incorporating Relative Humidity
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="creating-a-model-to-correct-purpleair-measurements">
<span id="ch-pa-modeling"></span><h1><span class="section-number">12.4. </span>Creating a Model to Correct PurpleAir Measurements<a class="headerlink" href="#creating-a-model-to-correct-purpleair-measurements" title="Permalink to this headline">¶</a></h1>
<p>Now that we’ve matched together PM2.5 readings from AQS and PurpleAir sensors,
we’re ready for the final step of the analysis: creating a model that
calibrates PurpleAir measurements.
Barkjohn’s original analysis fits many models to the data in order to find
the most appropriate one.
In this section, we’ll start by fitting several simpler models
using the techniques from the <a class="reference internal" href="../04/modeling_intro.html#ch-modeling"><span class="std std-ref">Modeling and Summary Statistics</span></a> chapter.
Then, we’ll fit a few models from Barkjohn’s analysis, including the final
model they chose for real-world use.
Since the final model uses methods that we introduce later in the book,
we won’t explain the technical details very deeply here—we
instead encourage you to revisit this section after reading the
<a class="reference internal" href="../15/linear_intro.html#ch-linear"><span class="std std-ref">Linear Models</span></a> and <span class="xref std std-ref">ch:mult_intro</span> chapters.</p>
<div class="section" id="loading-in-the-data">
<h2><span class="section-number">12.4.1. </span>Loading in the Data<a class="headerlink" href="#loading-in-the-data" title="Permalink to this headline">¶</a></h2>
<p>Let’s begin by loading in the cleaned dataset of matched AQS and PurpleAir
PM2.5 readings.
We do some data processing as we load in the CSV file.
Since this section focuses on modeling, we’ve left it as an exercise to
understand what the code does.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">csv_file</span> <span class="o">=</span> <span class="s1">&#39;data/cleaned_purpleair_aqs/Full24hrdataset.csv&#39;</span>
<span class="n">usecols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="s1">&#39;PM25FM&#39;</span><span class="p">,</span> <span class="s1">&#39;PM25cf1&#39;</span><span class="p">,</span> <span class="s1">&#39;TempC&#39;</span><span class="p">,</span> <span class="s1">&#39;RH&#39;</span><span class="p">,</span> <span class="s1">&#39;Dewpoint&#39;</span><span class="p">]</span>
<span class="n">full</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">usecols</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
<span class="n">full</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="s1">&#39;pm25aqs&#39;</span><span class="p">,</span> <span class="s1">&#39;pm25pa&#39;</span><span class="p">,</span> <span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;rh&#39;</span><span class="p">,</span> <span class="s1">&#39;dew&#39;</span><span class="p">]</span>
<span class="n">full</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>id</th>
      <th>region</th>
      <th>pm25aqs</th>
      <th>pm25pa</th>
      <th>temp</th>
      <th>rh</th>
      <th>dew</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-05-17</td>
      <td>AK1</td>
      <td>Alaska</td>
      <td>6.7</td>
      <td>8.62</td>
      <td>18.03</td>
      <td>38.56</td>
      <td>3.63</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-05-18</td>
      <td>AK1</td>
      <td>Alaska</td>
      <td>3.8</td>
      <td>3.49</td>
      <td>16.12</td>
      <td>49.40</td>
      <td>5.44</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-05-21</td>
      <td>AK1</td>
      <td>Alaska</td>
      <td>4.0</td>
      <td>3.80</td>
      <td>19.90</td>
      <td>29.97</td>
      <td>1.73</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>12427</th>
      <td>2019-02-20</td>
      <td>WI6</td>
      <td>North</td>
      <td>15.6</td>
      <td>25.30</td>
      <td>1.71</td>
      <td>65.78</td>
      <td>-4.08</td>
    </tr>
    <tr>
      <th>12428</th>
      <td>2019-03-04</td>
      <td>WI6</td>
      <td>North</td>
      <td>14.0</td>
      <td>8.21</td>
      <td>-14.38</td>
      <td>48.21</td>
      <td>-23.02</td>
    </tr>
    <tr>
      <th>12429</th>
      <td>2019-03-22</td>
      <td>WI6</td>
      <td>North</td>
      <td>5.8</td>
      <td>9.44</td>
      <td>5.08</td>
      <td>52.20</td>
      <td>-4.02</td>
    </tr>
  </tbody>
</table>
<p>12246 rows × 8 columns</p>
</div></div></div>
</div>
<p>We’ve included an explanation for each of the columns below.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>date</p></td>
<td><p>Date of the observation</p></td>
</tr>
<tr class="row-odd"><td><p>id</p></td>
<td><p>A unique label for a site, formatted as the US state abbreviation with a number. (We performed data cleaning for site ID <code class="docutils literal notranslate"><span class="pre">CA1</span></code>.)</p></td>
</tr>
<tr class="row-even"><td><p>region</p></td>
<td><p>The name of the region, which corresponds to a group of sites. (The <code class="docutils literal notranslate"><span class="pre">CA1</span></code> site is located in the <code class="docutils literal notranslate"><span class="pre">West</span></code> region.)</p></td>
</tr>
<tr class="row-odd"><td><p>pm25aqs</p></td>
<td><p>The PM2.5 measurement from the AQS sensor.</p></td>
</tr>
<tr class="row-even"><td><p>pm25pa</p></td>
<td><p>The PM2.5 measurement from the PurpleAir sensor.</p></td>
</tr>
<tr class="row-odd"><td><p>temp</p></td>
<td><p>Temperature, in Celcius.</p></td>
</tr>
<tr class="row-even"><td><p>rh</p></td>
<td><p>Relative humidity, ranging from 0 to 100%.</p></td>
</tr>
<tr class="row-odd"><td><p>dew</p></td>
<td><p>The dew point of the air. (Higher dew point means more moisture in the air.)</p></td>
</tr>
</tbody>
</table>
<p>Before we start modeling, we want to understand the data.
We’ll start by making some simple visualizations.
First, we’ll make a plot of the weekly average AQS PM2.5 over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="p">(</span><span class="n">full</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
 <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>
 <span class="p">[</span><span class="s1">&#39;pm25aqs&#39;</span><span class="p">]</span>
 <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
 <span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Weekly avg PM2.5 (AQS)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/pa_modeling_9_0.png" src="../../_images/pa_modeling_9_0.png" />
</div>
</div>
<p>We see that most PM2.5 values range between 5.0 and 15.0 µg m⁻³.</p>
<p>Next, we’ll plot the distribution of both AQS and PurpleAir PM2.5 readings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_dist</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
    <span class="c1"># We need to make sure the x- and y-axes have the same limits for both plots,</span>
    <span class="c1"># or else the plots will be difficult to compare</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">full</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;density&#39;</span><span class="p">,</span>
            <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We need to make sure the x- and y-axes have the same limits for both plots,</span>
<span class="c1"># or else the plots will be difficult to compare</span>
<span class="n">plot_dist</span><span class="p">(</span><span class="s1">&#39;pm25aqs&#39;</span><span class="p">)</span>
<span class="n">plot_dist</span><span class="p">(</span><span class="s1">&#39;pm25pa&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/pa_modeling_12_0.png" src="../../_images/pa_modeling_12_0.png" />
<img alt="../../_images/pa_modeling_12_1.png" src="../../_images/pa_modeling_12_1.png" />
</div>
</div>
<p>We see that the distributions of PM2.5 readings are skewed to the right.</p>
<p>Lastly, we’ll plot PurpleAir against AQS readings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">relplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">full</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;pm25aqs&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;pm25pa&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">4</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/pa_modeling_15_0.png" src="../../_images/pa_modeling_15_0.png" />
</div>
</div>
<p>Before starting this analysis, we expected that PurpleAir measurements
would generally overestimate the PM2.5.
And indeed, this is reflected in the scatter plot.</p>
</div>
<div class="section" id="our-modeling-procedure">
<h2><span class="section-number">12.4.2. </span>Our Modeling Procedure<a class="headerlink" href="#our-modeling-procedure" title="Permalink to this headline">¶</a></h2>
<p>First, let’s go over our modeling goals.
We want to create a model that predicts PM2.5 as
accurately as possible.
To do this, our model can make use of the PurpleAir measurements, as well as
the other variables in the data, such as the ambient temperature and relative
humidity.</p>
<p>Here, we treat the AQS measurements as the true PM2.5 values.
The AQS measurements are taken from carefully calibrated instruments and are
actively used by the US government for decision-making, so we have reason to
trust that the AQS PM2.5 values are accurate.</p>
<p>We plan to fit and compare several models on the data.
To do so, we first randomly split the data in <code class="docutils literal notranslate"><span class="pre">full</span></code> into a
training and testing set.
For all of our models, we’ll fit the model on the training set and report
the root mean squared error (RMSE) on the test set.
Intuitively, the held-out test set mimics new measurements
that the model “doesn’t see” while we fit it.
This means that we can treat the test set error as an
estimator for the model’s real-world performance.</p>
<p>We’ll set aside 1000 observations aside for the test set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">full</span><span class="p">)</span>
<span class="n">test_n</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># Shuffle the row labels</span>
<span class="n">shuffled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Split the data</span>
<span class="n">test</span>  <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">shuffled</span><span class="p">[:</span><span class="n">test_n</span><span class="p">]]</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">shuffled</span><span class="p">[</span><span class="n">test_n</span><span class="p">:]]</span>
<span class="n">train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>id</th>
      <th>region</th>
      <th>pm25aqs</th>
      <th>pm25pa</th>
      <th>temp</th>
      <th>rh</th>
      <th>dew</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2685</th>
      <td>2019-04-25</td>
      <td>CA2</td>
      <td>West</td>
      <td>7.17</td>
      <td>8.06</td>
      <td>22.99</td>
      <td>48.33</td>
      <td>11.46</td>
    </tr>
    <tr>
      <th>10214</th>
      <td>2018-08-30</td>
      <td>NC4</td>
      <td>Southeast</td>
      <td>12.60</td>
      <td>23.13</td>
      <td>33.01</td>
      <td>46.22</td>
      <td>19.98</td>
    </tr>
    <tr>
      <th>10516</th>
      <td>2019-08-14</td>
      <td>VT1</td>
      <td>North</td>
      <td>6.78</td>
      <td>8.70</td>
      <td>25.44</td>
      <td>49.25</td>
      <td>14.01</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>5402</th>
      <td>2019-10-10</td>
      <td>GA1</td>
      <td>Southeast</td>
      <td>6.70</td>
      <td>11.99</td>
      <td>23.52</td>
      <td>60.24</td>
      <td>15.35</td>
    </tr>
    <tr>
      <th>861</th>
      <td>2019-01-31</td>
      <td>AZ1</td>
      <td>Central Southwest</td>
      <td>9.40</td>
      <td>10.98</td>
      <td>20.90</td>
      <td>29.33</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>7282</th>
      <td>2018-08-10</td>
      <td>IA2</td>
      <td>North</td>
      <td>18.67</td>
      <td>43.22</td>
      <td>29.60</td>
      <td>50.17</td>
      <td>18.15</td>
    </tr>
  </tbody>
</table>
<p>11246 rows × 8 columns</p>
</div></div></div>
</div>
<p>We also plan to evaluate each model’s predictions on the test set,
so we’ll define a function to compute the RMSE of a set of predictions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rmse</span><span class="p">(</span><span class="n">predictions</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;pm25aqs&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">predictions</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="model-1-a-simple-constant-model">
<h2><span class="section-number">12.4.3. </span>Model 1: A Simple Constant Model<a class="headerlink" href="#model-1-a-simple-constant-model" title="Permalink to this headline">¶</a></h2>
<p>Now, let’s fit our first model—a constant model like the ones we
worked with in the previous <a class="reference internal" href="../04/modeling_intro.html#ch-modeling"><span class="std std-ref">Modeling and Summary Statistics</span></a> chapter.
Constant models only predict one number.
That is, our model <span class="math notranslate nohighlight">\( f_{\theta}(x) \)</span> is:</p>
<div class="math notranslate nohighlight">
\[
\begin{aligned}
f_{\theta}(x) = {\theta}
\end{aligned}
\]</div>
<p>For example, if we set <span class="math notranslate nohighlight">\( \theta = 5.5 \)</span>, then the model would predict
that the AQS PM2.5 reading is always 5.5.</p>
<p>In our previous discussion of the constant model, we found that we minimize
the mean squared error when we set <span class="math notranslate nohighlight">\( \hat{\theta} \)</span> to the mean of the
response variable.
In this case, we set <span class="math notranslate nohighlight">\( \hat{\theta} \)</span> to the mean AQS PM2.5 value, and
our model is simply:</p>
<div class="math notranslate nohighlight">
\[
\begin{aligned}
f_\hat{\theta}(x) = \text{mean(aqs)}
\end{aligned}
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model_1</span><span class="p">(</span><span class="n">train</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;f(x) = θ&#39;&#39;&#39;</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;pm25aqs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">predict</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we can fit the model on the training set and check its accuracy on the
test set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predict</span> <span class="o">=</span> <span class="n">model_1</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="n">rmse</span><span class="p">(</span><span class="n">predict</span><span class="p">(</span><span class="n">test</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.446107182896083
</pre></div>
</div>
</div>
</div>
<p>We’ve found that this simple model has a loss of 5.45 µg m⁻³.
Intuitively, this means that the model will usually be around 5.45 µg m⁻³
away from the actual AQS measurement.
We can see this when we mark the mean on the distribution
of AQS readings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;pm25aqs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">plot_dist</span><span class="p">(</span><span class="s1">&#39;pm25aqs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">);</span>
<span class="c1"># Most points are within 5.36 µg m⁻³ away from the mean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/pa_modeling_33_0.png" src="../../_images/pa_modeling_33_0.png" />
</div>
</div>
<p>This model is too simple to use in practice—it performs especially badly
when PM2.5 values are high, which is exactly where we care about model
accuracy the most!
Still, this serves as a useful baseline for future models and demonstrates
our modeling procedure.</p>
</div>
<div class="section" id="model-2-adjusting-purpleair-by-a-constant">
<h2><span class="section-number">12.4.4. </span>Model 2: Adjusting PurpleAir by a Constant<a class="headerlink" href="#model-2-adjusting-purpleair-by-a-constant" title="Permalink to this headline">¶</a></h2>
<p>Let’s fit a constant again, but with a twist: we’ll fit a model
that adjusts PurpleAir measurements by a constant rather than simply
outputting the average AQS measurement.
Our model is:</p>
<div class="math notranslate nohighlight">
\[
\begin{aligned}
f_{\theta}(x_i) = \text{PA}_i + \theta
\end{aligned}
\]</div>
<p>In this model, <span class="math notranslate nohighlight">\( \text{PA}_i \)</span> represents the PurpleAir measurement
for a row <span class="math notranslate nohighlight">\( x_i \)</span> in the data, and <span class="math notranslate nohighlight">\( \theta \)</span> is a constant we once again
need to fit.</p>
<p>We want to minimize the mean squared loss.
Let <span class="math notranslate nohighlight">\( \text{AQS}_i \)</span> denote the AQS reading for row <span class="math notranslate nohighlight">\( x_i \)</span> of the data.
Then, the mean squared loss is:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
L(\theta) &amp;= \frac{1}{n} \sum_i (\text{AQS}_i - f_{\theta}(x_i))^2 \\
&amp;= \frac{1}{n} \sum_i (\text{AQS}_i - (\text{PA}_i + \theta))^2
\end{aligned}
\end{split}\]</div>
<p>To minimize the loss, we can derive that
<span class="math notranslate nohighlight">\( \hat{\theta} = \frac{1}{n} \sum_i(\text{AQS}_i - \text{PA}_i) \)</span>.
In other words, <span class="math notranslate nohighlight">\( \hat{\theta} \)</span> is the mean difference between
AQS and PurpleAir readings.
We’ve left the derivation as an exercise for the reader.
After fitting on the training data, we have <span class="math notranslate nohighlight">\( \hat{\theta} = -4.86 \)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;pm25aqs&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;pm25pa&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-4.859246747707521
</pre></div>
</div>
</div>
</div>
<p>With this, we can implement our second model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model_2</span><span class="p">(</span><span class="n">train</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;f(x) = PA + θ&#39;&#39;&#39;</span>
    <span class="n">mean_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;pm25aqs&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;pm25pa&#39;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;pm25pa&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">mean_diff</span>
    
    <span class="k">return</span> <span class="n">predict</span>
</pre></div>
</div>
</div>
</div>
<p>To compare our models, we’ve written a small helper function called
<code class="docutils literal notranslate"><span class="pre">model_results</span></code> that outputs the models and their RMSE on the test set.
We’ll call this function to compare the results of the two models we’ve
defined thus far.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_results</span><span class="p">([</span><span class="n">model_1</span><span class="p">,</span> <span class="n">model_2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rmse</th>
    </tr>
    <tr>
      <th>model</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>f(x) = θ</th>
      <td>5.45</td>
    </tr>
    <tr>
      <th>f(x) = PA + θ</th>
      <td>7.33</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="section" id="why-did-model-2-perform-worse">
<h3><span class="section-number">12.4.4.1. </span>Why Did Model 2 Perform Worse?<a class="headerlink" href="#why-did-model-2-perform-worse" title="Permalink to this headline">¶</a></h3>
<p>Surprisingly, the second model has a worse RMSE than the first.
Why did this happen?
One way to diagnose these models is to subtract the model’s
predictions from the actual observed AQS values.
These differences are called the <em>residuals</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">residuals</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="n">predict</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;pm25aqs&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">predict</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot the residuals for both models and compare.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_residuals</span><span class="p">(</span><span class="n">models</span><span class="p">):</span>
    <span class="n">model_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="n">model</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
    <span class="n">resids</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span><span class="n">test</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">resid</span><span class="o">=</span><span class="n">residuals</span><span class="p">(</span><span class="n">model</span><span class="p">))</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">],</span>
        <span class="n">keys</span><span class="o">=</span><span class="n">model_names</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    
    <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">relplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">resids</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;pm25pa&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;resid&#39;</span><span class="p">,</span>
                    <span class="n">col</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                    <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="o">**</span><span class="n">k</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">))</span>
    <span class="n">g</span><span class="o">.</span><span class="n">set_xlabels</span><span class="p">(</span><span class="s1">&#39;PA&#39;</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">set_ylabels</span><span class="p">(</span><span class="s1">&#39;residuals&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_residuals</span><span class="p">([</span><span class="n">model_1</span><span class="p">,</span> <span class="n">model_2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/pa_modeling_52_0.png" src="../../_images/pa_modeling_52_0.png" />
</div>
</div>
<p>Note that a residual of 0 means that the model correctly predicted
the PM2.5. A positive residual means the model underestimated PM2.5, and
a negative residual means the model overestimated PM2.5.</p>
<p>We see that both models perform poorly at higher PM2.5 measurements.
Model 1, the simple constant model, tends to underestimate PM2.5.
Likewise, Model 2, the model that adjusts PurpleAir by a constant, tends
to overestimate PM2.5.</p>
<p>We saw earlier in this section that PurpleAir sensors tend to overestimate
PM2.5.
However, subtracting a constant value doesn’t seem to do enough to
correct PurpleAir readings.</p>
<p>Next, we’ll fit linear models on the data.
In this book, we cover linear models
in later chapters (Chapters <a class="reference internal" href="../15/linear_intro.html#ch-linear"><span class="std std-numref">15</span></a> and
<code class="xref std std-numref docutils literal notranslate"><span class="pre">%s</span></code>).
However, we include linear models in this section in order to match
Barkjohn’s analysis, and to produce the final model that is currently
in real-world use.</p>
</div>
</div>
<div class="section" id="model-3-simple-linear-regression">
<h2><span class="section-number">12.4.5. </span>Model 3: Simple Linear Regression<a class="headerlink" href="#model-3-simple-linear-regression" title="Permalink to this headline">¶</a></h2>
<p>Making a scatter plot of PurpleAir and AQS measurements shows that a linear
model can be appropriate:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../../_images/pa_modeling_57_0.png" src="../../_images/pa_modeling_57_0.png" />
</div>
</div>
<p>By eyeballing this plot, we might guess that
the PurpleAir PM2.5 is about twice as high as the actual PM2.5.
This idea is encapsulated in the simple linear model:</p>
<div class="math notranslate nohighlight">
\[
\begin{aligned}
f_{\theta}(x_i) = \theta_0 + \theta_1 \text{PA}_i
\end{aligned}
\]</div>
<p>To predict the PM2.5, this model multiplies the PurpleAir measurements
by <span class="math notranslate nohighlight">\( \theta_1 \)</span>, then adds a constant <span class="math notranslate nohighlight">\( \theta_0 \)</span>.</p>
<div class="section" id="using-a-linear-model-for-calibration">
<h3><span class="section-number">12.4.5.1. </span>Using a Linear Model for Calibration<a class="headerlink" href="#using-a-linear-model-for-calibration" title="Permalink to this headline">¶</a></h3>
<p>This is a <strong>calibration</strong> scenario.
We have PurpleAir sensors which we want to calibrate to match AQS sensors.
Then, we can adjust the PurpleAir readings using the correction we get
from calibration.</p>
<p>This is a two-step procedure:</p>
<ol class="simple">
<li><p>Fit a calibration model that uses AQS measurements to predict PurpleAir measurements.</p></li>
<li><p><em>Invert</em> the model to find <span class="math notranslate nohighlight">\( \hat \theta_1 \)</span> and <span class="math notranslate nohighlight">\( \hat \theta_0 \)</span>.</p></li>
</ol>
<p>In other words, we’ll fit this model first:</p>
<div class="math notranslate nohighlight">
\[
\begin{aligned}
\text{predicted } \text{PA}_i = b + m \cdot \text{AQS}_i
\end{aligned}
\]</div>
<p>Then, we invert this model:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\text{PA}_i &amp;= \hat b + \hat m \cdot \text{AQS}_i \\
\text{PA}_i - \hat b &amp;= \hat m \cdot \text{AQS}_i \\
\text{AQS}_i &amp;= \frac{1}{\hat m} \text{PA}_i - \frac{\hat b}{\hat m}
\end{aligned}
\end{split}\]</div>
<p>Which gives <span class="math notranslate nohighlight">\( \hat \theta_1 = \frac{1}{\hat m} \)</span> and
<span class="math notranslate nohighlight">\( \hat \theta_0 = - \frac{\hat b}{\hat m} \)</span></p>
<div class="admonition-why-invert-the-model admonition">
<p class="admonition-title">Why invert the model?</p>
<p>This procedure might seem a bit roundabout.
Why not fit a linear model for <span class="math notranslate nohighlight">\( f_{\theta}(x) \)</span>
that uses PurpleAir to predict AQS directly?
This would get <span class="math notranslate nohighlight">\( \hat \theta_1 \)</span> and <span class="math notranslate nohighlight">\( \hat \theta_0 \)</span> without
needing to invert anything.</p>
<p>Intuitively, linear models assume that the explanatory variable, or the variable
we put on the x-axis, has no error.
Linear models also assume that all the error occurs when we measure the response
variable, or the variable we put on the y-axis.
Thus, during calibration we treat the AQS measurements as the x-axis variable
since these measurements have relatively little error.
This allows us to model the error in PurpleAir measurements.
If we fit <span class="math notranslate nohighlight">\( f_{\theta}(x) \)</span> directly, we’ll say the opposite:
that the measurement error happens in the AQS readings rather than PurpleAir
readings.</p>
<p>As a simpler example, let’s say we’re calibrating a weight scale.
We could do this by first placing known weights—say 1 kg, 5 kg,
and 10 kg—onto the scale, and seeing what the scale reports.
Analogously, the AQS measurements are the known quantities, and we check
what the PurpleAir sensors report.</p>
<p>For a more rigorous treatment of statistical calibration,
see <span id="id1">[<a class="reference internal" href="../../references.html#id28">Osborne, 1991</a>]</span>.</p>
</div>
<p>Now, let’s define the model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="k">def</span> <span class="nf">model_3</span><span class="p">(</span><span class="n">train</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;f(x) = θ₀ + θ₁PA&#39;&#39;&#39;</span>
    <span class="c1"># Fit calibration model using sklearn</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">train</span><span class="p">[[</span><span class="s1">&#39;pm25aqs&#39;</span><span class="p">]],</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;pm25pa&#39;</span><span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">intercept_</span>
    
    <span class="c1"># Invert model</span>
    <span class="n">theta_1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">m</span>
    <span class="n">theta_0</span> <span class="o">=</span> <span class="o">-</span> <span class="n">b</span> <span class="o">/</span> <span class="n">m</span>
    
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">theta_0</span> <span class="o">+</span> <span class="n">theta_1</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;pm25pa&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">predict</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_results</span><span class="p">([</span><span class="n">model_1</span><span class="p">,</span> <span class="n">model_2</span><span class="p">,</span> <span class="n">model_3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rmse</th>
    </tr>
    <tr>
      <th>model</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>f(x) = θ</th>
      <td>5.45</td>
    </tr>
    <tr>
      <th>f(x) = PA + θ</th>
      <td>7.33</td>
    </tr>
    <tr>
      <th>f(x) = θ₀ + θ₁PA</th>
      <td>2.96</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We see that the linear model performs considerably better than the
other models we’ve done.
This is reflected in the residuals:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_residuals</span><span class="p">([</span><span class="n">model_1</span><span class="p">,</span> <span class="n">model_2</span><span class="p">,</span> <span class="n">model_3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/pa_modeling_74_0.png" src="../../_images/pa_modeling_74_0.png" />
</div>
</div>
<p>Happily, the residuals of the linear model shows that it still performs
relatively well even when PM2.5 is high.</p>
<p>Under this model, <span class="math notranslate nohighlight">\( \hat \theta_1 = 0.52 \)</span> and <span class="math notranslate nohighlight">\( \hat \theta_0 = 1.54 \)</span>, so our
fitted model predicts:</p>
<div class="math notranslate nohighlight">
\[
\begin{aligned}
f_{\hat \theta}(x) = 1.54 + 0.52 \text{PA}
\end{aligned}
\]</div>
</div>
</div>
<div class="section" id="model-4-incorporating-relative-humidity">
<h2><span class="section-number">12.4.6. </span>Model 4: Incorporating Relative Humidity<a class="headerlink" href="#model-4-incorporating-relative-humidity" title="Permalink to this headline">¶</a></h2>
<p>The final model that Barkjohn selected was a linear model that also incorporated
the relative humidity:</p>
<div class="math notranslate nohighlight">
\[
\begin{aligned}
f_{\theta}(x_i) = \theta_0 + \theta_1 \text{PA}_i + \theta_2 \text{RH}_i
\end{aligned}
\]</div>
<p>Here, <span class="math notranslate nohighlight">\( \text{PA}_i \)</span> and <span class="math notranslate nohighlight">\( \text{RH}_i \)</span> refer to the PurpleAir PM2.5 and the
relative humidity for row <span class="math notranslate nohighlight">\( x_i \)</span> of the data.
This is an example of a multivariable linear regression model—it uses
more than one variable to make predictions.</p>
<p>As before, we’ll fit the calibration model first:</p>
<div class="math notranslate nohighlight">
\[
\begin{aligned}
\text{predicted } \text{PA}_i = b + m_1 \cdot \text{AQS}_i + m_2 \cdot \text{RH}_i
\end{aligned}
\]</div>
<p>Then, we invert the calibration model to find the prediction model:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\text{PA}_i &amp;= \hat b + \hat m_1 \cdot \text{AQS}_i + \hat m_2 \cdot \text{RH}_i \\
\text{AQS}_i &amp;= - \frac{\hat b}{\hat m_1} + \frac{1}{\hat m_1} \text{PA}_i
    - \frac{\hat m_2}{\hat m_1} \text{RH}_i
\end{aligned}
\end{split}\]</div>
<p>Which gives <span class="math notranslate nohighlight">\( \hat \theta_0 = -\frac{\hat b}{\hat m_1} \)</span>,
<span class="math notranslate nohighlight">\( \hat \theta_1 = \frac{1}{\hat m_1} \)</span>, and
<span class="math notranslate nohighlight">\( \hat \theta_2 = - \frac{\hat m_2}{\hat m_1} \)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model_4</span><span class="p">(</span><span class="n">train</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;f(x) = θ₀ + θ₁PA + θ₂RH&#39;&#39;&#39;</span>
    <span class="c1"># Fit calibration model using sklearn</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">train</span><span class="p">[[</span><span class="s1">&#39;pm25aqs&#39;</span><span class="p">,</span> <span class="s1">&#39;rh&#39;</span><span class="p">]],</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;pm25pa&#39;</span><span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="p">[</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">],</span> <span class="n">b</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">intercept_</span>
    
    <span class="c1"># Invert to find parameters</span>
    <span class="n">theta_0</span> <span class="o">=</span> <span class="o">-</span> <span class="n">b</span> <span class="o">/</span> <span class="n">m1</span>
    <span class="n">theta_1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">m1</span>
    <span class="n">theta_2</span> <span class="o">=</span> <span class="o">-</span> <span class="n">m2</span> <span class="o">/</span> <span class="n">m1</span>
    
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">theta_0</span> <span class="o">+</span> <span class="n">theta_1</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;pm25pa&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">theta_2</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rh&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;pm25pa&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rh&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">m2</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="n">m1</span>
    <span class="k">return</span> <span class="n">predict</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_results</span><span class="p">([</span><span class="n">model_1</span><span class="p">,</span> <span class="n">model_2</span><span class="p">,</span> <span class="n">model_3</span><span class="p">,</span> <span class="n">model_4</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rmse</th>
    </tr>
    <tr>
      <th>model</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>f(x) = θ</th>
      <td>5.45</td>
    </tr>
    <tr>
      <th>f(x) = PA + θ</th>
      <td>7.33</td>
    </tr>
    <tr>
      <th>f(x) = θ₀ + θ₁PA</th>
      <td>2.96</td>
    </tr>
    <tr>
      <th>f(x) = θ₀ + θ₁PA + θ₂RH</th>
      <td>2.58</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We see that out of the four models, the model that incorporates PurpleAir and
relative humidity performs the best.
This is also reflected in its residual plot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_residuals</span><span class="p">([</span><span class="n">model_3</span><span class="p">,</span> <span class="n">model_4</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/pa_modeling_88_0.png" src="../../_images/pa_modeling_88_0.png" />
</div>
</div>
<p>From the residual plot, we can see that Model 4’s residuals are generally
closer to 0.
Model 4’s residuals trend downward less than Model 3’s, indicating a better
model fit.</p>
<p>After fitting the model, we have:
<span class="math notranslate nohighlight">\( \hat \theta_0 = 5.77 \)</span>, <span class="math notranslate nohighlight">\( \hat \theta_1 = 0.524 \)</span>, and
<span class="math notranslate nohighlight">\( \hat \theta_2 = -0.0860 \)</span>
so our fitted model predicts:</p>
<div class="math notranslate nohighlight">
\[
\begin{aligned}
f_{\hat \theta}(x) = 5.77 + 0.524 \cdot \text{PA} - 0.086 \cdot \text{RH}
\end{aligned}
\]</div>
<p>And thus, we’ve achieved our goal:
we have a model to correct PurpleAir PM2.5 measurements!
From our analysis, this model achieves a test set error of 2.58 µg m⁻³,
which is a useful improvement over our baseline models.
If the model can maintain this error rate for real-world data,
it should be practically useful—for instance, a “moderate” PM2.5 level
corresponds to 12-35 µg m⁻³, while a “unhealthy for sensitive groups”
PM2.5 level corresponds to 35-55 µg m⁻³ <span id="id2">[<a class="reference internal" href="../../references.html#id27">EPA, 2016</a>]</span>.
Our residual plot shows that applying our correction to PurpleAir sensors
makes most measurements within 5 µg m⁻³ away from the true PM2.5,
so we can reasonably recommend using PurpleAir sensors to report air quality.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./ch/12"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="pa_cleaning_purpleair.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">12.3. </span>Exploring and Cleaning PurpleAir Sensor Data</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="pa_conclusion.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">12.5. </span>In Conclusion</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Sam Lau, Joey Gonzalez, and Deb Nolan<br/>
    
        &copy; Copyright 2023.<br/>
      <div class="extra_footer">
        <p>
License: CC BY-NC-ND 4.0
</p>

      </div>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>