
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>11.2. Exploring and Cleaning AQS Sensor Data &#8212; Principles and Techniques of Data Science</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="11.3. Exploring and Cleaning PurpleAir Sensor Data" href="pa_cleaning_purpleair.html" />
    <link rel="prev" title="11.1. Finding Collocated Sensors" href="pa_collocated.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-113006011-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Principles and Techniques of Data Science</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  Frontmatter
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../preface.html">
   To the Reader
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../prereqs.html">
   Prerequisites
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../notation.html">
   Notation
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  The Data Science Lifecycle
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01/lifecycle_intro.html">
   1. The Data Science Lifecycle
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/lifecycle_students_1.html">
     1.1. The Students of Data 100
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/lifecycle_students_2.html">
     1.2. Exploratory Data Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/lifecycle_students_3.html">
     1.3. What’s in a Name?
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02/data_scope_intro.html">
   2. Data Scope
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data_scope_big_data_hubris.html">
     2.1. Big Data and New Opportunities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data_scope_construct.html">
     2.2. Target Population, Access Frame, Sample
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data_scope_protocols.html">
     2.3. Instruments and Protocols
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data_scope_natural.html">
     2.4. Measuring Natural Phenomenon
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data_scope_accuracy.html">
     2.5. Accuracy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data_scope_summary.html">
     2.6. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/data_scope_exercises.html">
     2.7. Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03/theory_intro.html">
   3. Theory for Data Design
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/theory_urn.html">
     3.1. The Urn Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/theory_election.html">
     3.2. Simulating Election Polls: Bias, Variance, and Big Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/theory_vaccine_efficacy.html">
     3.3. Simulating a Randomized Trial: Vaccine Efficacy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/theory_measurement_error.html">
     3.4. Measurement Error: Air Quality Variation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/theory_probability.html">
     3.5. Probability and the Urn Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/theory_exercises.html">
     3.6. Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04/modeling_intro.html">
   4. Modeling and Estimation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/modeling_simple.html">
     4.1. Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/modeling_loss_functions.html">
     4.2. Loss Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/modeling_abs_huber.html">
     4.3. Absolute and Huber Loss
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../05/cycle_case_study_intro.html">
   5. [In progress] Case Study
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Rectangular Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../06/pandas_intro.html">
   6. Working With Dataframes Using pandas
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/pandas_subsetting.html">
     6.1. Subsetting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/pandas_aggregating.html">
     6.2. Aggregating
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/pandas_joining.html">
     6.3. Joining
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/pandas_transforming.html">
     6.4. Transforming
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/pandas_other_reps.html">
     6.5. How are Dataframes Different from Other Data Representations?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/pandas_conclusion.html">
     6.6. Conclusion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06/pandas_exercises.html">
     6.7. Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../07/sql_intro.html">
   7. Working With Relations Using SQL
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/sql_subsetting.html">
     7.1. Subsetting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/sql_aggregating.html">
     7.2. Aggregating
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/sql_joining.html">
     7.3. Joining
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/sql_transforming.html">
     7.4. Transforming
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/sql_other_reps.html">
     7.5. How are Relations Different from Other Data Representations?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/sql_conclusion.html">
     7.6. Conclusion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07/sql_exercises.html">
     7.7. Exercises
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Understanding The Data
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../08/wrangling_intro.html">
   8. Data Wrangling
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/wrangling_datasets.html">
     8.1. Wrangling Data from Different Sources
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/wrangling_formats.html">
     8.2. File Formats
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/wrangling_command_line.html">
     8.3. The Shell and Command Line Tools
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/wrangling_granularity.html">
     8.4. Table Shape and Granularity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/wrangling_co2.html">
     8.5. Example: Wrangling CO2 Measurements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/wrangling_checks.html">
     8.6. Quality Checks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/wrangling_missing.html">
     8.7. Missing Values and Records
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/wrangling_transformations.html">
     8.8. Transformations and Timestamps
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/wrangling_structure.html">
     8.9. Modifying Structure
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/wrangling_restaurants.html">
     8.10. Example: Wrangling Restaurant Safety Violations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08/wrangling_summary.html">
     8.11. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../09/eda_intro.html">
   9. Exploratory Data Analysis
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/eda_feature_types.html">
     9.1. Feature Types
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/eda_distributions.html">
     9.2. What to Look For in a Distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/eda_relationships.html">
     9.3. What to Look For in a Relationship?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/eda_guidelines.html">
     9.4. Guidelines for Exploration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/eda_example.html">
     9.5. Example: Sale Prices for Houses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09/eda_summary.html">
     9.6. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../10/viz_intro.html">
   10. Data Visualization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/viz_quantitative.html">
     10.1. Visualizing Quantitative Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/viz_qualitative.html">
     10.2. Visualizing Qualitative Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/viz_matplotlib.html">
     10.3. Customizing Plots using
     <code class="docutils literal notranslate">
      <span class="pre">
       matplotlib
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/viz_principles.html">
     10.4. Visualization Principles
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/viz_principles_2.html">
     10.5. Visualization Principles Continued
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10/viz_philosophy.html">
     10.6. Philosophy for Data Visualization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="pa_intro.html">
   11. Case Study: Data Science for Accurate and Timely Air Quality Measurements
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="pa_collocated.html">
     11.1. Finding Collocated Sensors
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     11.2. Exploring and Cleaning AQS Sensor Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pa_cleaning_purpleair.html">
     11.3. Exploring and Cleaning PurpleAir Sensor Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pa_modeling.html">
     11.4. Creating a Model to Correct PurpleAir Measurements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pa_conclusion.html">
     11.5. In Conclusion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pa_exercises.html">
     11.6. Exercises
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Other Data Sources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../12/text_intro.html">
   12. Working with Text
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../12/text_strings.html">
     12.1. Python String Methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../12/text_regex.html">
     12.2. Regular Expressions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../12/text_re.html">
     12.3. Regex and Python
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../13/web_intro.html">
   13. Web Technologies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../13/web_http.html">
     13.1. HTTP
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../13/web_rest.html">
     13.2. [In Progress] REST
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../13/web_html.html">
     13.3. [In Progress] XPath and HTML
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Linear Modeling
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../14/linear_models.html">
   14. Linear Models
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../14/linear_tips.html">
     14.1. Predicting Tip Amounts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../14/linear_fitting.html">
     14.2. [In progress] Fitting a linear model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../14/linear_inference.html">
     14.3. [In progress] Inference for Linear Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../14/linear_projection.html">
     14.4. Least Squares — A Geometric Perspective
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../15/prob_and_gen.html">
   15. Probability and Generalization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/prob_random_vars.html">
     15.1. Random Variables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/prob_exp_var.html">
     15.2. Expectation and Variance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15/prob_risk.html">
     15.3. Risk
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../16/gradient_descent.html">
   16. Gradient Descent and Numerical Optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../16/gradient_basics.html">
     16.1. Loss Minimization Using a Program
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../16/gradient_descent_define.html">
     16.2. Gradient Descent
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../16/gradient_convexity.html">
     16.3. Convexity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../16/gradient_stochastic.html">
     16.4. Stochastic Gradient Descent
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../16/gradient_lin_reg.html">
     16.5. Fitting a Linear Model Using Gradient Descent
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../17/donkey_intro.html">
   17. [In progress] Case Study: Donkey Dimensions
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../17/donkey_analysis.html">
     17.1. Linear Regression Case Study
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Multiple Linear Modeling
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../18/mult_intro.html">
   18. [In progress] Multiple Linear Regression
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../18/mult_model.html">
     18.1. Multiple Linear Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../18/mult_inference.html">
     18.2. Inference for Multiple Linear Regression
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../19/feature_engineering.html">
   19. Feature Engineering
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
  <label for="toctree-checkbox-18">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../19/feature_one_hot.html">
     19.1. The Walmart dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../19/feature_polynomial.html">
     19.2. Predicting Ice Cream Ratings
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../20/bias_intro.html">
   20. The Bias-Variance Tradeoff
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
  <label for="toctree-checkbox-19">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../20/bias_risk.html">
     20.1. Risk and Loss Minimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20/bias_modeling.html">
     20.2. Model Bias and Variance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20/bias_cv.html">
     20.3. Cross-Validation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../21/reg_intro.html">
   21. Regularization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
  <label for="toctree-checkbox-20">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../21/reg_intuition.html">
     21.1. Regularization Intuition
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../21/reg_ridge.html">
     21.2. L2 Regularization: Ridge Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../21/reg_lasso.html">
     21.3. L1 Regularization: Lasso Regression
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../22/mult_case_intro.html">
   22. [In progress] Case Study: Multiple Linear Models
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Classification
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../23/classification_intro.html">
   23. Classification
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
  <label for="toctree-checkbox-21">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../23/classification_prob.html">
     23.1. Regression on Probabilities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../23/classification_log_model.html">
     23.2. The Logistic Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../23/classification_cost.html">
     23.3. A Loss Function for the Logistic Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../23/classification_log_reg.html">
     23.4. Using Logistic Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../23/classification_cost_justification.html">
     23.5. Approximating the Empirical Probability Distribution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../23/classification_sgd.html">
     23.6. Fitting a Logistic Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../23/classification_sensitivity_specificity.html">
     23.7. Evaluating Logistic Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../23/classification_multiclass.html">
     23.8. Multiclass Classification
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Replicability
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../24/repl_intro.html">
   24. [In progress] Replicable Research
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
  <label for="toctree-checkbox-22">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../24/repl_phacking.html">
     24.1. P-hacking
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Extra Topics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../25/pca_intro.html">
   25. Dimensionality Reduction and PCA
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
  <label for="toctree-checkbox-23">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../25/pca_dims.html">
     25.1. Dimensions of a Data Table
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../25/pca_svd.html">
     25.2. PCA using the Singular Value Decomposition
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../25/pca_in_practice.html">
     25.3. PCA in Practice
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../26/dtrees_intro.html">
   26. [In progress] Decision Trees and Random Forests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../27/clustering_intro.html">
   27. [In progress] Clustering
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Appendices
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../a01/prob_review.html">
   Probability Review
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../a02/vector_space_review.html">
   Vector Space Review
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../a03/hyp_intro.html">
   Statistical Inference Review
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/>
  <label for="toctree-checkbox-24">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../a03/hyp_introduction.html">
     Hypothesis Testing and Confidence Intervals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../a03/hyp_introduction_part2.html">
     Permutation Test
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../a04/ref_intro.html">
   Reference Tables
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/>
  <label for="toctree-checkbox-25">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../a04/ref_pandas.html">
     pandas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../a04/ref_seaborn.html">
     Seaborn
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../a04/ref_matplotlib.html">
     matplotlib
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../a04/ref_sklearn.html">
     scikit-learn
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../a05/contributors.html">
   Contributors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../references.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/ch/11/pa_cleaning_aqs.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        <a class="jupyterhub-button" href="https://datahub.berkeley.edu/hub/user-redirect/git-pull?repo=https://github.com/ds-100/textbook&urlpath=tree/textbook/content/ch/11/pa_cleaning_aqs.ipynb&branch=master"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#whats-the-granularity">
   11.2.1. What’s the Granularity?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#removing-unneeded-columns">
   11.2.2. Removing Unneeded Columns
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#checking-the-validity-of-date-local">
   11.2.3. Checking the Validity of
   <code class="docutils literal notranslate">
    <span class="pre">
     date_local
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#checking-the-validity-of-pm25">
   11.2.4. Checking the Validity of
   <code class="docutils literal notranslate">
    <span class="pre">
     pm25
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#next-steps">
   11.2.5. Next Steps
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Exploring and Cleaning AQS Sensor Data</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#whats-the-granularity">
   11.2.1. What’s the Granularity?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#removing-unneeded-columns">
   11.2.2. Removing Unneeded Columns
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#checking-the-validity-of-date-local">
   11.2.3. Checking the Validity of
   <code class="docutils literal notranslate">
    <span class="pre">
     date_local
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#checking-the-validity-of-pm25">
   11.2.4. Checking the Validity of
   <code class="docutils literal notranslate">
    <span class="pre">
     pm25
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#next-steps">
   11.2.5. Next Steps
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="exploring-and-cleaning-aqs-sensor-data">
<span id="ch-pa-cleaning-aqs"></span><h1><span class="section-number">11.2. </span>Exploring and Cleaning AQS Sensor Data<a class="headerlink" href="#exploring-and-cleaning-aqs-sensor-data" title="Permalink to this headline">¶</a></h1>
<p>Let’s briefly take stock of where we are in the analysis.
Our plan is roughly to:</p>
<ol class="simple">
<li><p>Find a list of possibly collocated AQS and PurpleAir sensors.</p></li>
<li><p>Contact AQS sites to find truly collocated sensor pairs.</p></li>
<li><p>Explore and clean AQS measurements for one sensor.</p></li>
<li><p>Explore and clean PurpleAir measurements for the other sensor in the pair,
then join the measurements together.</p></li>
<li><p>Join all the measurements together for all the sensor pairs.</p></li>
<li><p>Fit a model to make PurpleAir measurements match AQS measurements.</p></li>
</ol>
<p>We finished step 1 in the previous section (<a class="reference internal" href="pa_collocated.html#ch-pa-collocated"><span class="std std-numref">Section 11.1</span></a>). We
skipped step 2; we
decided to reuse Barkjohn’s list of truly collocated sensor pairs rather than
contacting the AQS sites ourselves.</p>
<p>In this section, we’ll proceed to step 3 of the analysis plan:
to explore and clean data from one AQS sensor.</p>
<p>We picked a sensor pair from Barkjohn’s list of collocated sensors.
The pair is located in Sacramento, California. The AQS sensor ID is
<code class="docutils literal notranslate"><span class="pre">06-067-0010</span></code>, and the PurpleAir sensor name is <code class="docutils literal notranslate"><span class="pre">AMTS_TESTINGA</span></code>.</p>
<p>The AQS provides a website and API to download sensor data <a class="footnote-reference brackets" href="#aqs-api" id="id1">1</a>.
For this sensor, Barkjohn’s analysis used data from May 20, 2018 to Dec 29, 2019.
We downloaded the daily measurements for these dates into the
<code class="docutils literal notranslate"><span class="pre">data/aqs_06-067-0010.csv</span></code> file. We’ll begin by loading this file into <code class="docutils literal notranslate"><span class="pre">pandas</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aqs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/aqs_06-067-0010.csv&#39;</span><span class="p">)</span>
<span class="n">aqs</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state_code</th>
      <th>county_code</th>
      <th>site_number</th>
      <th>parameter_code</th>
      <th>...</th>
      <th>city</th>
      <th>cbsa_code</th>
      <th>cbsa</th>
      <th>date_of_last_change</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>6</td>
      <td>67</td>
      <td>10</td>
      <td>88101</td>
      <td>...</td>
      <td>Sacramento</td>
      <td>40900</td>
      <td>Sacramento--Roseville--Arden-Arcade, CA</td>
      <td>2021-09-24</td>
    </tr>
    <tr>
      <th>1</th>
      <td>6</td>
      <td>67</td>
      <td>10</td>
      <td>88101</td>
      <td>...</td>
      <td>Sacramento</td>
      <td>40900</td>
      <td>Sacramento--Roseville--Arden-Arcade, CA</td>
      <td>2021-09-24</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 31 columns</p>
</div></div></div>
</div>
<p>As usual, this dataframe has too many columns to display in the notebook.
We’ll display the first row of data to see all the columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">display_df</span><span class="p">(</span><span class="n">aqs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(),</span> <span class="n">rows</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>state_code</th>
      <td>6</td>
    </tr>
    <tr>
      <th>county_code</th>
      <td>67</td>
    </tr>
    <tr>
      <th>site_number</th>
      <td>10</td>
    </tr>
    <tr>
      <th>parameter_code</th>
      <td>88101</td>
    </tr>
    <tr>
      <th>poc</th>
      <td>1</td>
    </tr>
    <tr>
      <th>latitude</th>
      <td>38.57</td>
    </tr>
    <tr>
      <th>longitude</th>
      <td>-121.49</td>
    </tr>
    <tr>
      <th>datum</th>
      <td>NAD83</td>
    </tr>
    <tr>
      <th>parameter</th>
      <td>PM2.5 - Local Conditions</td>
    </tr>
    <tr>
      <th>sample_duration</th>
      <td>24 HOUR</td>
    </tr>
    <tr>
      <th>pollutant_standard</th>
      <td>PM25 24-hour 2006</td>
    </tr>
    <tr>
      <th>date_local</th>
      <td>2018-12-31</td>
    </tr>
    <tr>
      <th>units_of_measure</th>
      <td>Micrograms/cubic meter (LC)</td>
    </tr>
    <tr>
      <th>event_type</th>
      <td>None</td>
    </tr>
    <tr>
      <th>observation_count</th>
      <td>1</td>
    </tr>
    <tr>
      <th>observation_percent</th>
      <td>100.0</td>
    </tr>
    <tr>
      <th>validity_indicator</th>
      <td>Y</td>
    </tr>
    <tr>
      <th>arithmetic_mean</th>
      <td>3.1</td>
    </tr>
    <tr>
      <th>first_max_value</th>
      <td>3.1</td>
    </tr>
    <tr>
      <th>first_max_hour</th>
      <td>0</td>
    </tr>
    <tr>
      <th>aqi</th>
      <td>13</td>
    </tr>
    <tr>
      <th>method_code</th>
      <td>145</td>
    </tr>
    <tr>
      <th>method</th>
      <td>R &amp; P Model 2025 PM-2.5 Sequential Air Sampler...</td>
    </tr>
    <tr>
      <th>local_site_name</th>
      <td>Sacramento-1309 T Street</td>
    </tr>
    <tr>
      <th>site_address</th>
      <td>1309 T ST., SACRAMENTO, CA. 95814</td>
    </tr>
    <tr>
      <th>state</th>
      <td>California</td>
    </tr>
    <tr>
      <th>county</th>
      <td>Sacramento</td>
    </tr>
    <tr>
      <th>city</th>
      <td>Sacramento</td>
    </tr>
    <tr>
      <th>cbsa_code</th>
      <td>40900</td>
    </tr>
    <tr>
      <th>cbsa</th>
      <td>Sacramento--Roseville--Arden-Arcade, CA</td>
    </tr>
    <tr>
      <th>date_of_last_change</th>
      <td>2021-09-24</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>From the data dictionary for this data <a class="footnote-reference brackets" href="#aqs-dict" id="id2">2</a>, we can find out that the
<code class="docutils literal notranslate"><span class="pre">arithmetic_mean</span></code> column corresponds to the actual PM2.5 measurements. Some AQS
sensors take a measurement every hour.
For our analysis, we downloaded the 24-hour averages (the arithmetic mean) of the
hourly sensor measurements.</p>
<p>Before we can use this data for analysis, we’ll perform validity checks with a
combination of EDA and visualization, then clean the data where necessary.</p>
<p>We will:</p>
<ol class="simple">
<li><p>Check and correct the granularity of the data.</p></li>
<li><p>Remove unneeded columns.</p></li>
<li><p>Check validity of the <code class="docutils literal notranslate"><span class="pre">date_local</span></code> column.</p></li>
<li><p>Check validity of the <code class="docutils literal notranslate"><span class="pre">arithmetic_mean</span></code> column.</p></li>
</ol>
<p>There are many more checks we could perform on this data. If we were planning
to publish this work more broadly, we would be as thorough as possible.
For the sake of brevity, we’ve chosen a few important validity checks that
specifically reinforce ideas we’ve covered in data wrangling, EDA, and visualization.</p>
<div class="section" id="whats-the-granularity">
<h2><span class="section-number">11.2.1. </span>What’s the Granularity?<a class="headerlink" href="#whats-the-granularity" title="Permalink to this headline">¶</a></h2>
<p>We would like each row of our data to correspond to a single date with an average
PM2.5 reading for that date. Is this the case for the <code class="docutils literal notranslate"><span class="pre">aqs</span></code> dataframe?
One simple way to check is to see whether there are repeat values in the
<code class="docutils literal notranslate"><span class="pre">date_local</span></code> column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aqs</span><span class="p">[</span><span class="s1">&#39;date_local&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2019-05-12    12
2019-11-14    12
2019-09-03    12
              ..
2019-01-30    12
2019-12-23    12
2019-05-27    12
Name: date_local, Length: 189, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Indeed, there are 12 rows for each date in <code class="docutils literal notranslate"><span class="pre">aqs</span></code>. So, the granularity is <em>not</em>
at the individual date level. To figure out why this happens, we can filter the
table to a single date, then look for columns that have different values within
that date.
If we do this, we find that the <code class="docutils literal notranslate"><span class="pre">pollutant_standard</span></code> and <code class="docutils literal notranslate"><span class="pre">event_type</span></code> columns
differ within a date.
Here, we display these columns for the date
<code class="docutils literal notranslate"><span class="pre">2018-12-31</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">one_date</span> <span class="o">=</span> <span class="p">(</span><span class="n">aqs</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;date_local == &quot;2018-12-31&quot;&#39;</span><span class="p">)</span>
 <span class="p">[[</span><span class="s1">&#39;date_local&#39;</span><span class="p">,</span> <span class="s1">&#39;pollutant_standard&#39;</span><span class="p">,</span> <span class="s1">&#39;event_type&#39;</span><span class="p">,</span> <span class="s1">&#39;arithmetic_mean&#39;</span><span class="p">]]</span>
<span class="p">)</span>
<span class="n">display_df</span><span class="p">(</span><span class="n">one_date</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date_local</th>
      <th>pollutant_standard</th>
      <th>event_type</th>
      <th>arithmetic_mean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2018-12-31</td>
      <td>PM25 24-hour 2006</td>
      <td>None</td>
      <td>3.1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2018-12-31</td>
      <td>PM25 24-hour 2006</td>
      <td>Included</td>
      <td>3.1</td>
    </tr>
    <tr>
      <th>140</th>
      <td>2018-12-31</td>
      <td>PM25 Annual 2006</td>
      <td>None</td>
      <td>3.1</td>
    </tr>
    <tr>
      <th>141</th>
      <td>2018-12-31</td>
      <td>PM25 Annual 2006</td>
      <td>Included</td>
      <td>3.1</td>
    </tr>
    <tr>
      <th>280</th>
      <td>2018-12-31</td>
      <td>PM25 24-hour 2012</td>
      <td>None</td>
      <td>3.1</td>
    </tr>
    <tr>
      <th>281</th>
      <td>2018-12-31</td>
      <td>PM25 24-hour 2012</td>
      <td>Included</td>
      <td>3.1</td>
    </tr>
    <tr>
      <th>420</th>
      <td>2018-12-31</td>
      <td>PM25 Annual 2012</td>
      <td>None</td>
      <td>3.1</td>
    </tr>
    <tr>
      <th>421</th>
      <td>2018-12-31</td>
      <td>PM25 Annual 2012</td>
      <td>Included</td>
      <td>3.1</td>
    </tr>
    <tr>
      <th>560</th>
      <td>2018-12-31</td>
      <td>PM25 24-hour 1997</td>
      <td>None</td>
      <td>3.1</td>
    </tr>
    <tr>
      <th>561</th>
      <td>2018-12-31</td>
      <td>PM25 24-hour 1997</td>
      <td>Included</td>
      <td>3.1</td>
    </tr>
    <tr>
      <th>700</th>
      <td>2018-12-31</td>
      <td>PM25 Annual 1997</td>
      <td>None</td>
      <td>3.1</td>
    </tr>
    <tr>
      <th>701</th>
      <td>2018-12-31</td>
      <td>PM25 Annual 1997</td>
      <td>Included</td>
      <td>3.1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>From the data dictionary, we learn that there are multiple standards for
computing the final measurements from the raw sensor data.
The <code class="docutils literal notranslate"><span class="pre">pollutant_standard</span></code> column contains the name of each standard.
The <code class="docutils literal notranslate"><span class="pre">event_type</span></code> column marks whether data measured during “exceptional events”
are included in the measurement.</p>
<p>However, for our data these columns seem to have no effect on the PM2.5
measurements.
For example, in the <code class="docutils literal notranslate"><span class="pre">2018-12-31</span></code> data above the PM2.5 measurements
are all identical.
We can verify this for the rest of the data by checking that the
maximum PM2.5 minus the minimum PM2.5 for each date is equal to zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">aqs</span>
 <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;date_local&#39;</span><span class="p">)</span>
 <span class="p">[</span><span class="s1">&#39;arithmetic_mean&#39;</span><span class="p">]</span>
 <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">)</span> <span class="c1"># np.ptp computes max() - min()</span>
 <span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="p">)</span>
<span class="c1"># For all 189 dates, the max PM2.5 - min PM2.5 is 0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0    189
Name: arithmetic_mean, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>So, we can simply take the first PM2.5 measurement for each date.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rollup_dates</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;date_local&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/aqs_06-067-0010.csv&#39;</span><span class="p">)</span>
       <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">rollup_dates</span><span class="p">))</span>
<span class="n">aqs</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date_local</th>
      <th>state_code</th>
      <th>county_code</th>
      <th>site_number</th>
      <th>...</th>
      <th>city</th>
      <th>cbsa_code</th>
      <th>cbsa</th>
      <th>date_of_last_change</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2018-05-20</td>
      <td>6</td>
      <td>67</td>
      <td>10</td>
      <td>...</td>
      <td>Sacramento</td>
      <td>40900</td>
      <td>Sacramento--Roseville--Arden-Arcade, CA</td>
      <td>2021-09-24</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2018-05-23</td>
      <td>6</td>
      <td>67</td>
      <td>10</td>
      <td>...</td>
      <td>Sacramento</td>
      <td>40900</td>
      <td>Sacramento--Roseville--Arden-Arcade, CA</td>
      <td>2021-09-24</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 31 columns</p>
</div></div></div>
</div>
<p>This data cleaning step gives us the desired granularity of <code class="docutils literal notranslate"><span class="pre">aqs</span></code>:
every row in <code class="docutils literal notranslate"><span class="pre">aqs</span></code> represents a single date, with an average PM2.5
measurement for that date.</p>
</div>
<div class="section" id="removing-unneeded-columns">
<h2><span class="section-number">11.2.2. </span>Removing Unneeded Columns<a class="headerlink" href="#removing-unneeded-columns" title="Permalink to this headline">¶</a></h2>
<p>We plan to match the PM2.5 measurements in the <code class="docutils literal notranslate"><span class="pre">aqs</span></code> dataframe with
the PurpleAir PM2.5 measurements for each date.
To simplify the data, we’ll subset out the date and PM2.5 columns and rename the
PM2.5 column so that it’s easier to understand.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">subset_cols</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;date_local&#39;</span><span class="p">,</span> <span class="s1">&#39;arithmetic_mean&#39;</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">subset</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;arithmetic_mean&#39;</span><span class="p">:</span> <span class="s1">&#39;pm25&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/aqs_06-067-0010.csv&#39;</span><span class="p">)</span>
       <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">rollup_dates</span><span class="p">)</span>
       <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">subset_cols</span><span class="p">))</span>
<span class="n">aqs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date_local</th>
      <th>pm25</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2018-05-20</td>
      <td>6.5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2018-05-23</td>
      <td>2.3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2018-05-29</td>
      <td>11.8</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>186</th>
      <td>2019-12-23</td>
      <td>5.7</td>
    </tr>
    <tr>
      <th>187</th>
      <td>2019-12-26</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>188</th>
      <td>2019-12-29</td>
      <td>19.5</td>
    </tr>
  </tbody>
</table>
<p>189 rows × 2 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="checking-the-validity-of-date-local">
<h2><span class="section-number">11.2.3. </span>Checking the Validity of <code class="docutils literal notranslate"><span class="pre">date_local</span></code><a class="headerlink" href="#checking-the-validity-of-date-local" title="Permalink to this headline">¶</a></h2>
<p>Let’s take a closer look at the <code class="docutils literal notranslate"><span class="pre">date_local</span></code> column.
We can already see that there are gaps in dates where there are no
PM2.5 readings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># The table is sorted by `date_local`, so we see that there are missing dates</span>
<span class="c1"># between 2018-05-20 and 2018-05-23, for example.</span>
<span class="n">aqs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date_local</th>
      <th>pm25</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2018-05-20</td>
      <td>6.5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2018-05-23</td>
      <td>2.3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2018-05-29</td>
      <td>11.8</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>186</th>
      <td>2019-12-23</td>
      <td>5.7</td>
    </tr>
    <tr>
      <th>187</th>
      <td>2019-12-26</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>188</th>
      <td>2019-12-29</td>
      <td>19.5</td>
    </tr>
  </tbody>
</table>
<p>189 rows × 2 columns</p>
</div></div></div>
</div>
<p>We can check that the <code class="docutils literal notranslate"><span class="pre">date_local</span></code> column contains strings:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Python strings are recorded as the `object` type in pandas</span>
<span class="n">aqs</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>date_local     object
pm25          float64
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aqs</span><span class="p">[</span><span class="s1">&#39;date_local&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;2018-05-20&#39;
</pre></div>
</div>
</div>
</div>
<p>However, we’d like to know: are all the strings valid dates? If so, we can
parse the dates as <code class="docutils literal notranslate"><span class="pre">pd.Timestamp</span></code> objects which will make it easier to compute
the dates that are missing from the data. To parse the dates, we’ll use the
<code class="docutils literal notranslate"><span class="pre">pd.to_datetime()</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is the Python representation of the YYYY-MM-DD format</span>
<span class="n">date_format</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span>

<span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">aqs</span><span class="p">[</span><span class="s1">&#39;date_local&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="n">date_format</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0     2018-05-20
1     2018-05-23
2     2018-05-29
         ...    
186   2019-12-23
187   2019-12-26
188   2019-12-29
Name: date_local, Length: 189, dtype: datetime64[ns]
</pre></div>
</div>
</div>
</div>
<p>We see that the <code class="docutils literal notranslate"><span class="pre">dtype</span></code> of this series is <code class="docutils literal notranslate"><span class="pre">datetime64[ns]</span></code> rather than
<code class="docutils literal notranslate"><span class="pre">object</span></code>, which means that the values are <code class="docutils literal notranslate"><span class="pre">pd.TimeStamp</span></code> objects rather than
strings. Also, the method runs without erroring, indicating that all the
strings matched the format.</p>
<p>Now, we can reassign the <code class="docutils literal notranslate"><span class="pre">date_local</span></code> column as <code class="docutils literal notranslate"><span class="pre">pd.TimeStamp</span></code>s.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parse_dates</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">date_format</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span>
    <span class="n">timestamps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;date_local&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="n">date_format</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">date_local</span><span class="o">=</span><span class="n">timestamps</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/aqs_06-067-0010.csv&#39;</span><span class="p">)</span>
       <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">rollup_dates</span><span class="p">)</span>
       <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">subset_cols</span><span class="p">)</span>
       <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">parse_dates</span><span class="p">))</span>
<span class="n">aqs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date_local</th>
      <th>pm25</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2018-05-20</td>
      <td>6.5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2018-05-23</td>
      <td>2.3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2018-05-29</td>
      <td>11.8</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>186</th>
      <td>2019-12-23</td>
      <td>5.7</td>
    </tr>
    <tr>
      <th>187</th>
      <td>2019-12-26</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>188</th>
      <td>2019-12-29</td>
      <td>19.5</td>
    </tr>
  </tbody>
</table>
<p>189 rows × 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aqs</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>date_local    datetime64[ns]
pm25                 float64
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Just because the dates can be parsed doesn’t mean that the dates are immediately
ready to use for further analysis. For instance, the string <code class="docutils literal notranslate"><span class="pre">9999-01-31</span></code> can be
parsed into a <code class="docutils literal notranslate"><span class="pre">pd.TimeStamp</span></code>, but the date isn’t valid.</p>
</div>
<p>Now that the <code class="docutils literal notranslate"><span class="pre">date_local</span></code> contains timestamps, we can calculate how
many dates are missing. We’ll find the number of days between the earliest and
latest date—this corresponds to the maximum number of measurements we could
have recorded.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">date_range</span> <span class="o">=</span> <span class="n">aqs</span><span class="p">[</span><span class="s1">&#39;date_local&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">aqs</span><span class="p">[</span><span class="s1">&#39;date_local&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">date_range</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Timedelta(&#39;588 days 00:00:00&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Subtracting timestamps give Timedelta objects, which have a few useful</span>
<span class="c1"># properties like:</span>
<span class="n">date_range</span><span class="o">.</span><span class="n">days</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>588
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;We have </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">aqs</span><span class="p">)</span><span class="si">}</span><span class="s1"> / </span><span class="si">{</span><span class="n">date_range</span><span class="o">.</span><span class="n">days</span><span class="si">}</span><span class="s1"> measurements, &#39;</span>
      <span class="sa">f</span><span class="s1">&#39;or </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">aqs</span><span class="p">)</span> <span class="o">/</span> <span class="n">date_range</span><span class="o">.</span><span class="n">days</span><span class="si">:</span><span class="s1">.0%</span><span class="si">}</span><span class="s1"> of the dates possible.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>We have 189 / 588 measurements, or 32% of the dates possible.
</pre></div>
</div>
</div>
</div>
<p>There are many dates missing from the data. However, when we combine this
data with the data from the other AQS and PurpleAir sensors, we
expect that we’ll have enough data to fit a model.</p>
<p>There are other modeling scenarios where this amount of missing data might
cause more concern, and we’ve included an exercise at the end of this chapter
to think about potential issues.</p>
</div>
<div class="section" id="checking-the-validity-of-pm25">
<h2><span class="section-number">11.2.4. </span>Checking the Validity of <code class="docutils literal notranslate"><span class="pre">pm25</span></code><a class="headerlink" href="#checking-the-validity-of-pm25" title="Permalink to this headline">¶</a></h2>
<p>There are a few checks we can perform on the PM2.5 measurements.
First, PM2.5 can’t go below 0.
Second, we can look for abnormally high PM2.5 values and see whether they
correspond to major events like a wildfire.</p>
<p>One simple way to perform these checks is to plot the PM2.5 against the date.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">aqs</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date_local&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;pm25&#39;</span><span class="p">)</span>
<span class="c1"># Rotate x-axis labels to avoid overlap</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/pa_cleaning_aqs_45_0.png" src="../../_images/pa_cleaning_aqs_45_0.png" />
</div>
</div>
<p>We can see that the PM2.5 measurements don’t go below 0.</p>
<p>We also a large spike in PM2.5 around November of 2018. This sensor is located
in Sacramento, CA—was there a fire around that area?</p>
<p>Indeed, November 8, 2018 marks the start of the Camp Fire, the “deadliest and
most destructive wildfire in California history” <span id="id3">[<a class="reference internal" href="../../references.html#id26">Bureau, 2018</a>]</span>. The fire
started just 80 miles north of Sacramento, so this AQS sensor captured the
dramatic spike in PM2.5.</p>
</div>
<div class="section" id="next-steps">
<h2><span class="section-number">11.2.5. </span>Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<p>We’ve cleaned and explored the data for an AQS sensor.
In the next section, we’ll do the same for its collocated PurpleAir sensor.</p>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="aqs-api"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p><a class="reference external" href="https://aqs.epa.gov/aqsweb/documents/data_api.html">https://aqs.epa.gov/aqsweb/documents/data_api.html</a></p>
</dd>
<dt class="label" id="aqs-dict"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p><a class="reference external" href="https://aqs.epa.gov/aqsweb/airdata/FileFormats.html#_hourly_data_files">https://aqs.epa.gov/aqsweb/airdata/FileFormats.html#_hourly_data_files</a></p>
</dd>
</dl>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./ch/11"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="pa_collocated.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">11.1. </span>Finding Collocated Sensors</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="pa_cleaning_purpleair.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">11.3. </span>Exploring and Cleaning PurpleAir Sensor Data</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Sam Lau, Joey Gonzalez, and Deb Nolan<br/>
    
        &copy; Copyright 2022.<br/>
      <div class="extra_footer">
        <p>
License: CC BY-NC-ND 4.0
</p>

      </div>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>