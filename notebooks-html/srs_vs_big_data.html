
<div id="ipython-notebook">
    <div class="buttons">
        <a class="interact-button" href="http://data100.datahub.berkeley.edu/user-redirect/interact?repo=https://github.com/DS-100/textbook&path=notebooks/ch2/srs_vs_big_data.ipynb">Open on DataHub</a></div>
    <div class="cell border-box-sizing code_cell rendered">
<div class="input hidden">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># HIDDEN</span>
<span class="c1"># Clear previously defined variables</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">var</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'__'</span><span class="p">):</span>
        <span class="k">del</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">var</span><span class="p">]</span>

<span class="c1"># Set directory for data loading to work properly</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">'~/notebooks/ch2'</span><span class="p">))</span>
</pre></div></div></div></div></div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input hidden">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># HIDDEN</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="k">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">interactive</span><span class="p">,</span> <span class="n">fixed</span><span class="p">,</span> <span class="n">interact_manual</span>
<span class="kn">import</span> <span class="nn">nbinteract</span> <span class="k">as</span> <span class="nn">nbi</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s1">'talk'</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_rows</span> <span class="o">=</span> <span class="mi">7</span>
</pre></div></div></div></div></div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id='SRS-vs.-"Big-Data"'>SRS vs. "Big Data"<a class="anchor-link" href='#SRS-vs.-"Big-Data"'>Â¶</a></h2><p>As we have previously mentioned, it is tempting to do away with our long-winded bias concerns by using huge amounts of data. It is true that collecting a census will by definition produce unbiased estimations. Perhaps we don't have to worry about bias if we just collect tons of data.</p>
<p>Suppose we are pollsters in 2012 trying to predict the popular vote of the US presidential election, where Barack Obama ran against Mitt Romney. Since we know the exact output of the popular vote, we can compare the predictions of a SRS to the predictions of a large non-random dataset, often called <em>administrative datasets</em> since they are often collected as part of some administrative work.</p>
<p>We will compare a SRS of size 400 to a non-random sample of size 60,000,000. Our non-random sample is nearly 150,000 times larger than our SRS! Since there were about 120,000,000 voters in 2012, we can think of our non-random sample as a survey where half of all voters in the US responded (no actual poll has ever surveyed more than 10,000,000 voters).</p></div></div></div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input hidden">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># HIDDEN</span>
<span class="n">total</span> <span class="o">=</span> <span class="mi">129085410</span>
<span class="n">obama_true_count</span> <span class="o">=</span> <span class="mi">65915795</span>
<span class="n">romney_true_count</span> <span class="o">=</span> <span class="mi">60933504</span>
<span class="n">obama_true</span> <span class="o">=</span> <span class="n">obama_true_count</span> <span class="o">/</span> <span class="n">total</span>
<span class="n">romney_true</span> <span class="o">=</span> <span class="n">romney_true_count</span> <span class="o">/</span> <span class="n">total</span>

<span class="c1"># 1 percent off</span>
<span class="n">obama_big</span> <span class="o">=</span> <span class="n">obama_true</span> <span class="o">-</span> <span class="mf">0.01</span>
<span class="n">romney_big</span> <span class="o">=</span> <span class="n">romney_true</span> <span class="o">+</span> <span class="mf">0.01</span>
</pre></div></div></div></div></div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here's a plot comparing the proportions of the non-random sample to the true proportions. The bars labeled <code>truth</code> show the true proportions of votes that each candidate received. The bars labeled <code>big</code> show the proportions from our dataset of 60,000,000 voters.</p></div></div></div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'truth'</span><span class="p">:</span> <span class="p">[</span><span class="n">obama_true</span><span class="p">,</span> <span class="n">romney_true</span><span class="p">],</span>
    <span class="s1">'big'</span><span class="p">:</span> <span class="p">[</span><span class="n">obama_big</span><span class="p">,</span> <span class="n">romney_big</span><span class="p">],</span>
<span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">'Obama'</span><span class="p">,</span> <span class="s1">'Romney'</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'truth'</span><span class="p">,</span> <span class="s1">'big'</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Truth compared to a big non-random dataset'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Candidate'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Proportion of popular vote'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">)</span>
<span class="kc">None</span>
</pre></div></div></div></div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">






<div class="output_png output_subarea ">
<img src="/notebooks-images/srs_vs_big_data_5_0.png"/></div></div></div></div></div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can see that our large dataset is just a bit biased towards the Republican candidate Romney just as the Gallup Poll was in 1948. Still, this dataset could give us accurate predictions. To check, we can simulate taking simple random samples of size 400 from the population and large non-random samples of size 60,000,000. We will compute the proportion of votes for Obama in each sample and plot the distribution of proportions.</p></div></div></div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">srs_size</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">big_size</span> <span class="o">=</span> <span class="mi">60000000</span>
<span class="n">replications</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="k">def</span> <span class="nf">resample</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">replications</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">replications</span><span class="p">)</span> <span class="o">/</span> <span class="n">size</span>

<span class="n">srs_simulations</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span><span class="n">srs_size</span><span class="p">,</span> <span class="n">obama_true</span><span class="p">,</span> <span class="n">replications</span><span class="p">)</span>
<span class="n">big_simulations</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span><span class="n">big_size</span><span class="p">,</span> <span class="n">obama_big</span><span class="p">,</span> <span class="n">replications</span><span class="p">)</span>
</pre></div></div></div></div></div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, we will plot the simulation results and overlay a red line indicating the true proportion of voters that voted for Obama.</p></div></div></div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.47</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">srs_simulations</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'srs'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">big_simulations</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'big'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Proportion of Obama Voters for SRS and Big Data'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Proportion'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Percent per unit'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.47</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">obama_true</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'truth'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="kc">None</span>
</pre></div></div></div></div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">






<div class="output_png output_subarea ">
<img src="/notebooks-images/srs_vs_big_data_9_0.png"/></div></div></div></div></div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As you can see, the SRS distribution is spread out but centered around the true population proportion of Obama voters. The distribution created by the large non-random sample, on the other hand, is very narrow but not a single simulated sample produces the true population proportion. If we attempt to create confidence intervals using the non-random sample, none of them will contain the true population proportion. To make matters worse, the confidence interval will be extremely narrow because the sample is so large. We will be very sure of an ultimately incorrect estimation.</p>
<p>In fact, when our sampling method is biased our estimations will become <strong>worse</strong> as we collect more data since we will be more certain about an incorrect result, only becoming more accurate when our dataset is almost a census of our population. <strong>The quality of the data matters much more than its size.</strong></p></div></div></div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Takeaways">Takeaways<a class="anchor-link" href="#Takeaways">Â¶</a></h2><p>Before accepting the results of a data analysis, it pays to carefully inspect the quality of the data. In particular, we must ask the following questions:</p>
<ol>
<li>Is the data a census (does it include the entire population of interest)? If so, we can just compute properties of the population directly without having to use inference.</li>
<li>If the data is a sample, how was the sample collected? To properly conduct inference, the sample should have been collected according to a probability sampling method.</li>
<li>What changes were made to the data before producing results? Do any of these changes affect the quality of the data?</li>
</ol>
<p>For more details on the comparison between random and large non-random samples, we suggest watching <a href="https://www.youtube.com/watch?v=yz3jOIHLYhU">this lecture by the statistician Xiao-Li Meng</a>.</p></div></div></div></div>
